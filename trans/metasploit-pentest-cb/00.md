# 零、序言

渗透测试是当今场景中网络安全的核心方面之一。它包括通过实施真实的安全测试对系统进行完整的分析。它有助于识别系统主要组件中可能出现在硬件或软件中的潜在弱点。渗透测试之所以成为安全的一个重要方面，是因为它有助于从黑客的角度识别威胁和弱点。漏洞可被实时利用，以找出漏洞的影响，然后探索合适的补救措施或补丁，以保护系统免受任何外部攻击，并减少风险因素。

决定渗透测试可行性的最大因素是对目标系统的了解。黑箱渗透测试是在目标用户没有先验知识的情况下进行的。笔测试人员必须从头开始，收集关于目标系统的每一点信息，以便实施攻击。在白盒测试中，关于目标的完整知识是已知的，测试人员必须识别可能存在的任何已知或未知弱点。渗透测试的两种方法中的任何一种都同样困难，并且是特定于环境的。行业专业人士已经确定了几乎所有渗透测试形式中必不可少的一些关键步骤。这些是：

*   **目标发现和枚举：**识别目标并收集其基本信息，无需与目标进行任何物理连接
*   **漏洞识别：**实施扫描、远程登录、网络服务等多种发现方法，找出目标系统上运行的不同服务和软件
*   **漏洞利用：**利用目标系统上运行的任何软件或服务中的已知或未知漏洞进行攻击
*   **攻击后的控制级别：**这是成功攻击后攻击者可以对目标系统进行的访问级别
*   **报告：**准备关于脆弱性及其可能的应对措施的建议

这些步骤在数量上看起来可能很少，但事实上，对一个运行大量服务的高端系统进行完整的渗透测试可能需要几天甚至几个月才能完成。渗透测试之所以成为一项漫长的任务，是因为它基于“试错”技术。漏洞和漏洞在很大程度上取决于系统配置，因此除非我们尝试，否则我们永远无法确定某个漏洞是否会成功。考虑开发一个运行 10 种不同服务的基于 Windows 的系统的例子。pen 测试人员必须识别这 10 个不同服务是否存在任何已知漏洞。一旦它们被识别，利用的过程就开始了。这是一个小例子，我们只考虑一个系统。如果我们有这样一个完整的系统网络来逐一渗透呢？

这就是渗透测试框架开始发挥作用的地方。它们自动化了多个测试过程，如扫描网络、根据可用服务及其版本识别漏洞、自动利用漏洞等。他们向测试人员证明了一个完整的控制面板，从而加快了 pen 测试过程，测试人员可以从中管理所有活动并有效监控目标系统。渗透测试框架的另一个重要好处是生成报告。它们自动化了保存渗透测试结果的过程，并生成可保存供以后使用的报告，或可与远程工作的其他对等方共享的报告。

*Metasploit 渗透测试食谱*旨在帮助读者掌握当今场景中使用最广泛的渗透测试框架之一。Metasploit 框架是一个开源平台，有助于创建真实的开发场景以及渗透测试的其他核心功能。这本书将带你去探索 Metasploit 世界的激动人心的旅程，以及如何使用它来执行有效的笔测试。本书还将介绍一些其他扩展工具，这些工具运行在框架上，并增强其功能，以提供更好的笔测试体验。

# 这本书涵盖的内容

[第一章](01.html "Chapter 1. Metasploit Quick Tips for Security Professionals")*Metasploit 安全专业人士快速提示*，是进入 Metasploit 和渗透测试领域的第一步。本章对框架、其体系结构和库进行了基本介绍。为了开始渗透测试，我们需要一个设置，因此本章将指导您使用虚拟机设置自己的虚拟渗透测试环境。稍后，本章将讨论如何在不同的操作系统上安装该框架。本章最后介绍了 Metasploit 的第一次体验及其接口。

[第 2 章](02.html "Chapter 2. Information Gathering and Scanning")*信息采集和扫描*是渗透测试的第一步。它从最传统的信息收集方式开始，然后发展到使用 Nmap 进行扫描。本章还介绍了一些附加工具，如 Nessus 和 NeXpose，通过提供附加信息来说明 Nmap 的局限性。最后，本章讨论了 Dradis 框架，该框架被 pen 测试人员广泛使用，用于与其他远程测试人员共享测试结果和报告。

[第 3 章](03.html "Chapter 3. Operating System-based Vulnerability Assessment and Exploitation")*基于操作系统的漏洞评估与利用*讲述了在目标系统上运行的未修补操作系统中查找漏洞。基于操作系统的漏洞具有很高的成功率，并且很容易被利用。本章讨论了渗透几种流行的操作系统，如 WindowsXP、Windows7 和 Ubuntu。本章介绍了这些操作系统的一些流行的和已知的漏洞，以及如何在 Metasploit 中使用它们来入侵目标机器。

[第 4 章](04.html "Chapter 4. Client-side Exploitation and Antivirus Bypass")*客户端攻击和防病毒绕过*将我们的讨论带入下一步，我们将讨论如何使用 Metasploit 执行客户端攻击。本章介绍了一些流行的客户端软件，如 Microsoft Office、Adobe Reader 和 Internet Explorer。稍后，本章将广泛讨论如何终止客户端防病毒保护，以防止在目标系统中引发警报。

[第 5 章](05.html "Chapter 5. Using Meterpreter to Explore the Compromised Target")*使用 MeterMeter 探测受害目标*，讨论了攻击后的下一步。MeterMeter 是一种攻击后工具，具有多种功能，有助于穿透受害目标并获取更多信息。本章介绍了一些有用的渗透测试技术，如权限提升、访问文件系统和按键嗅探。

[第 6 章](06.html "Chapter 6. Advanced Meterpreter Scripting")*高级计量器脚本*通过涵盖一些高级主题，将我们的元软件知识提升到了一个新的水平，例如构建我们自己的计量器脚本和使用 API 混合。本章将为读者提供灵活性，因为他们可以根据场景在框架中实现自己的脚本。本章还介绍了一些高级的后期开发概念，如旋转、传递散列和持久连接。

[第 7 章](07.html "Chapter 7. Working with Modules for Penetration Testing")*与渗透测试模块*合作，将我们的重点转移到 Metasploit 的另一个重要方面；它的模块。Metasploit 有一个合适的特定模块集合，可以在特定场景下使用。本章将介绍一些重要的辅助模块，以及稍后构建我们自己的 Metasploit 模块的进展。本章需要一些 Ruby 脚本的基本知识。

[第 8 章](08.html "Chapter 8. Working with Exploits")*与漏洞*合作，通过讨论如何将任何漏洞转化为 Metasploit 模块，将最终武器添加到兵工厂中。这是一个高级章节，将使读者能够构建自己的 Metasploit 利用模块并将其导入框架。由于框架中没有涵盖所有的漏洞利用，因此，如果我们想测试 Metasploit 存储库中不存在的漏洞利用，本章将非常方便。本章还讨论了模糊化模块，这些模块可用于为任何漏洞构建自己的概念证明。最后，本章以一个完整的示例结束，说明如何模糊应用程序以找到溢出条件，然后为其构建 Metasploit 模块。

[第 9 章](09.html "Chapter 9. Working with Armitage")*与 Armitage*合作，简要讨论了流行的元 sploit 扩展之一 Armitage。它为框架提供了一个图形界面，并通过提供点击式开发选项来增强其功能。本章重点介绍 Armitage 的重要方面，如快速查找漏洞、处理多个目标、在选项卡之间切换以及处理攻击后的问题。

[第 10 章](10.html "Chapter 10. Social Engineer Toolkit")*社会工程师工具包*是本书的最终讨论，涵盖了框架的另一个重要扩展。**社会工程师工具包（SET）**用于生成依赖人为疏忽的测试用例，以损害目标。本章涵盖了与包括钓鱼网络攻击、网站攻击向量、生成传染媒介（如 USB）相关的基本攻击向量。

# 这本书你需要什么

要遵循并重新创建本书的食谱，您需要两个系统。一个可以是你的笔测试系统，另一个可以是你的目标。或者，您也可以使用单个系统，并使用任何虚拟化软件设置渗透测试环境。

除此之外，您还需要 BackTrack 5 的 ISO 映像，其中预装了 Metasploit 和我们将在本书中讨论的其他工具。或者，您也可以从 Metasploit 的官方网站上为首选操作系统单独下载 Metasploit 框架。

# 这本书是给谁的

这本书的目标是专业的渗透测试人员，以及愿意专门使用该工具的 Metasploit 新用户。每个人都有自己的东西。这本书的食谱结构易于阅读、理解和回忆。这本书从渗透测试的基础知识开始，后来又发展到专家水平。从初学者到高级水平的过渡是顺利的。因此，所有类别的读者都可以轻松阅读和理解。本书要求具备扫描、开发和 Ruby 语言的基本知识。

# 公约

在这本书中，你会发现许多不同类型的文本可以区分不同类型的信息。下面是这些风格的一些例子，并解释了它们的含义。

文本中的代码字如下所示：“最后两个命令， `vulns`和 `db_autopwn`是后开发命令，我们将在后面的章节中处理。”

代码块设置如下：

```
# Register command execution options
register_options(
[
OptString.new('USER', [ true, "The username to create", "metasploit" ]),
OptString.new('PASS', [ true, "The password for this user", "metasploit" ]),
], self.class)

```

任何命令行输入或输出的编写方式如下：

```
$ chmod +x framework-4.*-linux-full.run
$ sudo ./framework-4.*-linux-full.run 

```

**新术语**和**重要词语**以粗体显示。例如，您在屏幕上、菜单或对话框中看到的文字会出现在文本中，如下所示：“您可以从**应用程序**菜单或命令行启动 Metasploit 框架”。

### 注

警告或重要注释显示在这样的框中。

### 提示

提示和技巧如下所示。

# 读者反馈

我们欢迎读者的反馈。让我们知道你对这本书的看法你喜欢或可能不喜欢什么。读者反馈对于我们开发您真正从中获益最多的标题非常重要。

要向我们发送一般反馈，只需向`<[feedback@packtpub.com](mailto:feedback@packtpub.com)>`发送电子邮件，并通过邮件主题提及书名即可。

如果您对某个主题有专业知识，并且您有兴趣撰写或贡献一本书，请参阅我们的作者指南，网址为[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

既然您是一本 Packt 图书的骄傲拥有者，我们有很多东西可以帮助您从购买中获得最大收益。

## 下载示例代码

您可以下载您在[账户购买的所有 Packt 书籍的示例代码文件 http://www.packtpub.com](http://www.packtpub.com) 。如果您在其他地方购买了本书，您可以访问[http://www.packtpub.com/support](http://www.packtpub.com/support) 并注册，将文件直接通过电子邮件发送给您。

## 勘误表

虽然我们已尽一切努力确保内容的准确性，但错误确实会发生。如果您在我们的一本书中发现错误，可能是文本或代码中的错误，如果您能向我们报告，我们将不胜感激。通过这样做，您可以使其他读者免于沮丧，并帮助我们改进本书的后续版本。如果您发现任何错误，请访问[进行报告 http://www.packtpub.com/support](http://www.packtpub.com/support) ，选择您的书籍，点击**勘误表提交表**链接，输入您勘误表的详细信息。一旦您的勘误表得到验证，您的提交将被接受，勘误表将上传到我们的网站，或添加到该标题勘误表部分的任何现有勘误表列表中。

## 盗版

在互联网上盗版版权材料是所有媒体的一个持续问题。在 Packt，我们非常重视版权和许可证的保护。如果您在互联网上发现我们作品的任何形式的非法复制品，请立即向我们提供地址或网站名称，以便我们采取补救措施。

请致电`<[copyright@packtpub.com](mailto:copyright@packtpub.com)>`与我们联系，并提供可疑盗版材料的链接。

我们感谢您在保护我们的作者方面的帮助，以及我们为您带来有价值内容的能力。

## 问题

如果您对本书的任何方面有疑问，请致电`<[questions@packtpub.com](mailto:questions@packtpub.com)>`与我们联系，我们将尽力解决。
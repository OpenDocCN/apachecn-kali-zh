# 了解 Pentesting 过程的各个阶段

在**信息技术**（**IT**的早期，不需要担心系统中的任何安全威胁或弱点。随着技术和移动设备的进步，许多人试图了解利用计算系统和网络的艺术。互联网的建立是一个重要的里程碑，它不仅在机构内部而且在全球范围内改善了信息的共享和可用性。随着信息和知识变得越来越容易获得，许多人在数字世界中利用它来达到好的和坏的目的。

想象一个人坐在家里上网，研究利用他人计算机或网络上的漏洞/弱点的方法和技术。那太可怕了，不是吗？一个简单的例子是，一个组织中的一名不满的员工担任管理人员，他对网络安全或计算领域一无所知。不满的员工可能希望在离开公司时对组织造成伤害，例如破坏公司本地文件服务器中存储的数据。如果他们决定在空闲时间研究各种黑客技术，这最终可能会变成一个*i**nsider 威胁*。

网络安全领域的渗透测试对于许多 IT 专业人员来说是一条非常有趣的道路。让这一点如此有趣的是，渗透测试人员必须发现许多方法来成功开发系统。有时，利用漏洞可能会在客户端或目标的一个系统上工作，但不会在另一个系统上工作。这就是渗透测试人员最需要的创造性思维。就个人而言，我喜欢尝试（作为渗透测试人员）进入一个似乎有点挑战性的系统的挑战；如果一切都很容易破解，有什么好玩的？

在本章中，我们将介绍以下主题：

*   什么是网络安全领域的渗透测试？
*   渗透测试方法
*   渗透测试的阶段
*   使用方法或过程的动机
*   进行渗透测试的预期可交付成果

开始吧！

# 渗透测试的必要性

在计算机发展的早期，**黑客**一词是指在使用计算机系统方面具有非凡技能的人。这种类型的人通常被称为**计算机天才（ard）**。如今，术语**黑客**是指在使用计算机对个人、组织或系统造成某种恶意行为或伤害方面具有非凡技能的人。

网络安全专业人员的需求量很大，因为每天都有新的威胁出现，黑客们更容易掌握各种工具和资源。组织意识到他们的资产处于风险之中，需要受到保护，免受任何内部或外部恶意行为者的侵害。组织寻求了解和发现其系统中的漏洞，如计算机、服务器、交换机、路由器、防火墙、终端设备和员工。公司很快意识到有必要聘请网络安全专家来帮助改善其组织的安全状况。渗透测试员的角色是在网络安全的世界中产生的。

# 黑客类型

如果你问一些黑客他们背后的意图或动机是什么，你可能会从每个人那里得到不同的答案。人们做坏事有很多原因；在网络安全领域也是如此。有些人喜欢黑客是为了好玩，有些人是为了钱，而有些人这样做是为了反对一个州或国家内的政客。

# 白帽子

**白帽**黑客只是网络安全世界中的好人。他们利用自己的黑客技能和技术帮助分析威胁、测试系统和网络，并实施缓解措施。

# 灰帽子

黑客们在 IT 安全的进攻和防御方面处于中间位置。这群黑客利用他们的知识和技能做好事和坏事。

# 黑帽子

**黑帽**黑客是一个拥有非常独特技能的人，他利用自己的知识进行恶意活动。

# 脚本小子

在渗透测试领域起步时，大多数黑客和专业人员通常都是从脚本小子开始的。**脚本小子**是一个不熟练的黑客，他使用其他黑客的脚本和工具，主要是**图形用户界面**（**GUI**工具来破坏目标系统或网络。

# 自杀黑客

**自杀式黑客**是指不惜一切代价摧毁目标系统的黑客，即使这意味着要受到法律的惩罚。

# 黑客行为主义者

你可能知道，**活动家**是为社会或政治议程而运动的人。有一些积极分子反对虐待动物。在数字世界中，有反对各种议程的黑客行动主义者。**黑客行动主义者**是利用他们的技能促进社会或政治议程的黑客。黑客行动主义组织的一个例子是臭名昭著的黑客组织**匿名**。

# 国家资助的黑客

这群黑客通常由一个国家的政府创建，其唯一目的是发动网络战攻击和对另一个国家进行侦察。

# 渗透测试

有时候在面试中，管理团队可能会问被面试者，*我们为什么要雇佣黑客？*管理层有时会认为一个拥有黑客技能的人将面临巨大的安全风险，这是准确的。然而，另一个问题出现了：他们为什么不雇佣黑客？拥有黑客技能和良好个人心态的人可以利用他们的知识帮助防止内部和外部安全威胁，并发现组织系统和网络基础设施中的任何隐藏缺陷。

道德黑客或白帽黑客通常是利用其信息安全专业知识和渗透组织系统和网络的能力的人。道德黑客，或渗透测试人员，识别隐藏的漏洞并模拟真实世界的攻击，以测试组织的安全系统和缓解控制。但是，道德黑客/渗透测试人员在进行任何类型的安全测试之前，必须获得客户和必要机构的法律许可。

白帽黑客、道德黑客和渗透测试人员是相同的；这些术语可以互换使用。

为什么有人要在网络或系统上进行渗透测试？许多组织认为他们的网络和资产不会受到坏人（黑客）的攻击，但实际上并非如此。正如思科系统前执行主席兼首席执行官所说：*“有两种类型的公司：被黑客攻击的公司和不知道自己被黑客攻击的公司。”*通常，许多组织没有意识到其网络上存在安全漏洞，检测时间通常是攻击发生后数月。此时，攻击者可能窃取了大量数据，创建了新的后门，并在公司中植入了**高级持续威胁**（**APTs**。

要在游戏中击败黑客，你必须像黑客一样思考。这就是渗透测试人员的角色所在。渗透测试人员将发现内部安全团队可能遗漏的常规和隐藏漏洞，并对组织的系统和网络进行模拟现实攻击，以利用发现的任何漏洞。在恶意黑客之前发现缺陷和弱点可以让组织在网络上实施预防和缓解技术和控制方面占上风，从而减少组织的攻击面。

# 蓝队对红队对紫队

许多组织都意识到需要与他们的公司建立一个网络安全团队。IT 安全团队通常分为两种颜色：红色和蓝色。每个团队都有其独特的目标，而两个团队的总体目标是确保保持健康的安全态势，并降低信息安全风险。

# 蓝队

蓝队的目标是什么？他们是干什么的？你为什么需要它们？对其资产（有形资产、无形资产和员工）进行估价的组织将确保其受到良好的保护，免受恶意黑客的攻击，因为网络攻击可以在任何时候从内部或外部发起。最困难的任务之一是实时检测并缓解网络攻击。通常，在**信息技术和通信**（**ICT**部门）内雇佣一组网络安全人员，以主动加强组织系统和网络基础设施内的安全。这个团体被称为“蓝队”。

**蓝色团队**持续监控网络，以发现来自公司内部、内部或外部的新威胁和现有威胁，他们是网络的捍卫者。然而，对手红队有不同的目标。

# 红队

红队的目标与蓝队大不相同。红队专注于持续攻击组织的系统和网络。你可能想知道为什么会有这样一个目标的团队存在。正如前面提到的[第一章](01.html)、*介绍到 Kali NetHunter*中所述，黑客出于各种原因总是试图未经授权访问他人或公司的系统。但是，未经授权访问另一个系统或网络是非法的，因为它具有侵入性。由于数字世界中日益增长的威胁，组织需要继续改善其安全态势。

**红色团队**是外部承包商或是内部团队，其目标是持续模拟真实世界的网络攻击。这是为了确保发现所有漏洞，并确定每个漏洞如何被真正的恶意黑客利用。红队就像黑帽黑客，他们与一个组织签约，发现所有隐藏的漏洞，利用任何漏洞，并在测试结束时提供详细报告。

# 紫色队

**紫色团队**是红色和蓝色团队的组合。该团队专注于进行攻击性安全测试和防御网络攻击者。与红色和蓝色团队不同，他们不是网络安全（进攻或防御）双方的专属团队，而是一个组织的统一安全咨询小组。

# 渗透测试的类型

每当指派渗透测试人员模拟针对目标组织的真实攻击时，通常会进行三种渗透测试中的一种：白盒、灰盒和黑盒。每种类型都将确定哪些资产同时受到内部威胁和外部方（如黑帽黑客）的威胁。

**白盒**测试是一种简单的渗透测试，因为在模拟攻击之前，已知目标系统和网络的完整知识。这对渗透测试人员来说是有益的，因为他们将拥有关于目标网络的大量信息，并且可以更好地利用工具和资源创建、交付和执行有效负载，这些负载在第一次尝试时最有可能成功。然而，这种类型的渗透试验有一个缺点。道德黑客或渗透测试人员很可能不会在测试前提供的知识之外寻找任何隐藏的漏洞和系统，也不会寻找系统基础设施的完整知识。

**黑盒**测试是指未向渗透测试人员提供有关目标系统或基础设施的信息或知识。渗透测试人员将像一个真正的黑帽黑客一样进入目标。有时只提供公司名称或网站信息。道德黑客或渗透测试人员需要做所有艰苦的工作，以确定组织类型及其行业、网络基础设施中的网络和安全设备类型、员工等。

**灰盒**测试介于白盒和黑盒渗透测试之间。在实际的安全审计或渗透测试之前，渗透测试人员只能提供非常有限的关于目标基础设施的信息。

# 渗透测试的阶段

在对系统或网络执行渗透测试之前，我们必须首先创建*交战规则*或行动计划。如果渗透测试人员只是冲进网络并对目标发起随机攻击，这将是不专业的。此外，当根据目标上的漏洞决定攻击的工具和类型时，制定行动计划使手头的工作更简单。

# 攻击前阶段

**攻击前阶段**侧重于渗透测试的规划和准备，这是在与目标系统或网络直接交战之前完成的。在此阶段，渗透测试人员将创建一个工具、脚本和操作系统的武库，用于攻击阶段。在实际渗透测试之前确定渗透方法非常重要，它将创建一个系统的方法来实现 pen 测试的每个目标。

在攻击前阶段，我们不能忘记一个最重要的目标，即与客户讨论交战规则。这一点非常重要，因为双方，即渗透测试人员和客户，必须就将要进行的测试类型、测试持续时间、目标系统和网络达成一致意见和谅解，如果进行远程测试，则尽可能提供源 IP 地址、侵入式或非侵入式测试，等等

到目前为止，我们已经了解到，企业雇佣安全专业人员，如渗透测试人员，来检查安全控制，并发现其系统或网络中的任何隐藏漏洞。有时，一个组织可能会聘请渗透测试人员来模拟对其 web 应用程序的真实攻击，而另一家公司可能需要对其 Windows 服务器进行安全审计。从渗透测试仪的角度来看，单一方法并不总是适用于每个目标。在这里，渗透测试人员可以创建自己的方法，以适合目标所需的测试类型。

在攻击阶段之前，尽可能多地了解目标信息非常有用。让我们把这看作是一次军事行动；在发动攻击之前，将军或高级官员会派遣一支部队进行侦察，并在未被发现的情况下（秘密）收集尽可能多的目标信息。这一概念也适用于渗透测试；关于目标的更多信息将有助于渗透测试人员发现缺陷和弱点。一旦在目标上发现漏洞（弱点），下一步就是使用有效的漏洞利用该漏洞/弱点。这是在攻击阶段完成的。

信息，如开放端口、设备类型、操作系统、网络布局、安全设备和网络共享，通常在渗透测试的攻击前阶段找到。

# 攻击阶段

**攻击阶段**对渗透测试人员来说可能有点挑战性。在此阶段，利用漏洞获得对目标系统和/或网络的访问。有时，利用漏洞可能不起作用，这可能有点令人沮丧。在特定有效负载不损害目标的情况下，开发环境非常有用。然而，渗透测试仪不应仅依赖于进入目标的单个入口点，而应具有多种访问方法。这一概念不仅展示了渗透测试仪的技术技能，还展示了目标本身的许多缺陷。

在攻击前阶段收集的有关目标的信息将用于确定要在目标上使用的攻击类型。获取目标可以使用从知名在线存储库中发现的现有漏洞，如攻击性安全（[www.Exploit-db.com](http://www.exploit-db.com)）的**漏洞数据库，或使用**Metasploit**（[等漏洞开发框架 https://www.rapid7.com/products/metasploit/](https://www.rapid7.com/products/metasploit/)**

通常攻击者会破坏目标系统上的标准帐户以最小化检测，然后他们会尝试将权限升级为系统/管理权限或根权限。在此阶段，渗透测试人员在受损系统内植入恶意代码，以创建远程访问的后门，并开始在网络上横向移动，以危害其他潜在的目标。

# 攻击后阶段

**攻击后阶段**的重点是清理攻击阶段留下的任何物品。这些是有效负载、脚本和渗透测试期间使用的其他文件。该报告通常在该阶段结束时完成，并提交给客户，概述执行的各种安全测试及其结果。

# 渗透测试方法和框架

在本节中，我们将了解各种渗透测试方法和框架。首先，我们必须理解方法论的含义。**方法学**是运用系统方法应用于研究领域或活动的一套方法。渗透测试领域的另一个重要术语是术语框架。**渗透测试框架**是一个全面的指南，详细说明了每类渗透测试的使用和安全审计工具。

完成渗透测试的第一次培训可能非常令人兴奋，而且您可能非常渴望破解某些东西。假设您在客户端的网络上，并且您开始同时刺激您的攻击，重点是一组特定的漏洞或系统。可能会发生大量的失火——漏洞攻击可能会击中渗透测试协议范围之外的目标——这可能会对业务造成不利影响，并造成不良声誉。其次，如果不使用系统的方法，在测试结束时可能无法获得预期的结果。

因此，在渗透测试的攻击前阶段，最好选择最适合潜在目标基础设施的方法或框架。该框架将确保渗透测试人员在获得预期输出和结果解释时遵循一套特定的指南。

以下是一些比较流行的渗透测试方法和框架：

*   OWASP 测试指南
*   PCI 渗透测试指南
*   渗透测试执行标准
*   **开源安全测试方法手册**（**OSSTMM**

# OWASP 测试框架

**开放式 Web 应用程序安全项目**（**OWASP**测试框架被定义为针对常见 Web 应用程序和安全服务问题的低级渗透测试指南。它被开发为一个最佳实践渗透测试框架，供任何人在其组织内实施。

OWASP 测试指南 v4 可在[中找到 https://www.owasp.org/index.php/OWASP_Testing_Project](https://www.owasp.org/index.php/OWASP_Testing_Project) 。

OWASP 测试框架概述了五个阶段：

*   **第一阶段：开发开始前**
    *   定义系统开发生命周期（SDLC）
    *   审查政策
    *   制定度量和量度标准并确保跟踪

*   **第二阶段：定义和设计期间**
    *   审查安全要求
    *   审查设计和架构
    *   创建和审查 UML 模型
    *   创建和审查威胁模型

*   **第三阶段：开发期间**
    *   代码演练
    *   代码审查

*   **第四阶段：部署期间**
    *   应用渗透测试
    *   配置管理测试

*   **第五阶段：维护和运行**
    *   进行运营管理审查
    *   定期进行健康检查
    *   确保变更验证

有关 OWASP 测试框架的更多信息，请访问[https://www.owasp.org/index.php/The_OWASP_Testing_Framework](https://www.owasp.org/index.php/The_OWASP_Testing_Framework) 。

此外，OWASP 一直致力于在全球范围内提供 web 安全意识和提高 web 安全性的方法。他们的**OWASP 前 10**是 web 应用程序中最关键的安全风险列表。

以下是**OWASP Top 10–2017**web 应用程序关键安全风险列表：

*   A1:2017-注射
*   A2:2017—断开的身份验证
*   A3:2017 敏感数据暴露
*   A4:2017-XML 外部实体（XXE）
*   A5:2017-中断的访问控制
*   A6:2017-安全配置错误
*   A7:2017-跨站点脚本（XSS）
*   A8:2017-不安全的反序列化
*   A9:2017-使用具有已知漏洞的组件
*   A10:2017-不足记录&监测

有关 OWASP 2017 年前 10 名名单中各类别的详细信息，请访问[https://www.owasp.org/index.php/Top_10-2017_Top_10](https://www.owasp.org/index.php/Top_10-2017_Top_10) 。

# PCI 渗透测试指南

计划或参与任何类型的支付卡交易（如信用卡）的组织必须符合**支付卡行业数据安全标准（****PCI DSS**）。PCI DSS 政策和标准用于保护和提高信用、借记和现金交易的安全性，同时保护持卡人的**个人身份信息**（**PII**。

《PCI 渗透测试指南》概述了其方法中的以下阶段：

*   参与前（规划）
*   交战：渗透测试（发现和攻击）
*   交战后（攻击后）

# 渗透测试执行标准

**渗透测试执行标准**（**PTES**由七个阶段组成，涵盖渗透测试的各个方面：

*   参与前互动
*   情报收集
*   威胁建模
*   脆弱性分析
*   剥削
*   实施漏洞利用
*   报告

有关 PTE 的更多信息，请访问[http://www.pentest-standard.org/index.php/Main_Page](http://www.pentest-standard.org/index.php/Main_Page) 。

# 开源安全测试方法手册

**开源安全测试方法手册****OSSTMM**由**安全与开放方法研究所****ISECOM**开发并发布，作为如何改进安全测试和实施的指南。

OSSTMM 与前面提到的方法和框架稍有不同，该方法还测试组织、运营和电信安全性和合规性。

以下是 OSSTMM 中的域：

*   运营安全指标
*   信任分析
*   工作流程
*   人类安全测试
*   物理安全测试

*   无线安全测试
*   电信安全测试
*   数据网络安全测试
*   合规条例
*   向 STAR 报告（安全测试审计报告）

# 渗透测试的阶段

到目前为止，我们已经了解了各种渗透方法和框架。到现在为止，你可能想知道如何把它们放在一起。在渗透测试培训课程中，您首先学习的内容之一是黑客攻击的五个阶段。在每个阶段，作为渗透测试人员/道德黑客都有需要完成的目标；一个阶段通向下一个阶段，直到最后阶段完成：

*   侦察
*   扫描
*   获取访问权限
*   维护访问权限
*   清除轨道

# 侦察

**侦察**阶段是最重要的阶段。这一阶段是关于收集有关目标的信息；渗透测试人员关于目标的信息越多，就越容易利用它。在此阶段，通常会进行以下操作：

*   雅虎、必应和谷歌等搜索引擎的使用
*   在社交网站上搜索有关公司和员工的信息（过去和现在）
*   使用谷歌黑客技术收集目标更精确的信息
*   使用各种工具对目标网站进行足迹跟踪
*   正在执行有关目标的域注册表信息收集
*   直接和间接社会工程

# 扫描

这一阶段是与实际目标交战的更直接方法。**扫描**阶段有助于渗透测试人员识别打开和关闭的端口、网络上的活动主机、系统和网络上运行的服务、操作系统类型以及系统上的漏洞。在扫描阶段，收集的信息将为渗透测试仪提供目标环境的拓扑视图。

以下是扫描的目标：

*   检查带电机器
*   检查入侵防御系统（IPS）
*   检查防火墙
*   检查打开和关闭的端口
*   检查服务版本
*   检查漏洞
*   创建网络图

# 获取访问权限

这是渗透测试人员试图破坏目标系统或网络的攻击阶段。在此阶段，突防可能会创建一个自定义有效载荷，以远程或在实际目标上执行。

这一阶段有两个目标：

*   获得访问权限
*   升级权限

# 维护访问权限

一旦目标系统被破坏，渗透测试人员将尝试创建多个后门访问实例，以防他们不再能够通过漏洞访问系统。一些渗透测试人员利用此机会植入**远程访问特洛伊木马**（**RATs**）或创建僵尸网络来控制受损系统。

该阶段的目标如下：

*   创建和维护远程访问
*   隐藏文件
*   窃取数据

# 清除轨道

此阶段用于清除目标系统和网络上所有可能的入侵痕迹；作为一名渗透测试人员，我们喜欢尽可能隐蔽地模拟真实世界的攻击。

这一阶段有两个目标：

*   清除所有日志
*   覆盖轨道

# 可交付成果

渗透测试结束时，将向客户提供一份报告，概述发现的所有漏洞，并提供完整的详细信息。渗透测试报告还包含每个系统受损漏洞的证据，以表明概念证明。此有助于客户的安全团队在其基础设施上实施缓解技术和预防控制。一些渗透测试报告包含缓解技术，而另一些则不包含。这取决于客户和所提供服务的渗透测试人员之间的相互协议。

最重要的是，报告是对事件和所进行测试的行动以及每项测试结果的完整总结。作为渗透测试人员，我们的报告有时有点过于技术化，但是我们的最终报告应该在执行层编写，非技术人员可以阅读和理解。

# 总结

在本章中，我们了解了当今世界和未来对渗透测试的需求。随着新威胁的出现，我们的资产和数据的安全面临着前所未有的风险。我们对不同类型的黑客及其可能的黑客动机进行了简要的比较和对比。此外，我们还讨论了组织内各种安全团队的需求，以帮助改善不断增长的威胁环境的安全态势，最后，我们讨论了黑客方法和概念。

在下一章中，我们将介绍情报收集工具。
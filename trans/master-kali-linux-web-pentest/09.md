## 第 9 章压力测试认证与会话管理

如果攻击者能够找到合法用户或表现得像合法用户，并且应用程序相信他，那么任何下游保护都无法阻止非法操作。在[第 8 章](Mastering%20Kali%20Linux%20for%20Web%20Penetration%20Testing_split_000.html#)*中，通过密码测试*利用信任，我们看到了攻击者如何拦截并通过一些努力——动态代理或解密信息。要使这些攻击起作用，需要做很多事情，攻击者有被网络防御或有意识的用户注意到的风险。认证应用程序使用的是另一种情况。用户不断向 web 应用程序和安全团队施压，要求他们简化和改进登录体验，而这种压力往往与应用程序的安全性直接冲突。由于应用程序所有者不愿推动用户使用更新的硬件和软件，不愿经历任何中断或冗长的登录过程，不愿放弃访问自由和多任务处理能力，因此他们通常设计的应用程序使用的是安全性差得多、更常见的客户端配置文件。应用程序登录和会话管理过程在采取措施以防止导致最近历史上一些最大漏洞的许多缺陷方面进展缓慢。

会话管理被证明是为了使安全性更加灵活。用户不喜欢通过**虚拟专用网络**（**VPN**）隧道进行连接，因此 web 应用程序已经从使用唯一的会话密钥发展到身份验证 cookie，现在又发展到身份验证令牌，每个令牌都允许用户继续访问并允许服务器跟踪有状态信息。在初始身份验证之后，这是一个巨大的帮助，因为它允许 HTTP 爆炸式地使用，而无需用户不断地证明他们的身份。对于黑客来说，会话管理方法现在是他们可以击败的一种机制——拥有凭证不再是劫持会话或冒充用户的必要条件。

身份验证和会话管理漏洞通常也是协调破坏工作的第二个级别。而其他折衷方案将支持初始��海滩头酒店�� 在目标环境中，对环境中使用的用户存储进行暴力强制通常是允许攻击者通过横向移动和权限提升来保持访问的关键。与企业使用**轻型目录访问协议（LDAP）**、Microsoft**Active Directory**（**AD**）或其他身份存储不同，门户网站通常都是经过大量定制的，很少在购买时进行适当加固。这就是我们要操作的地方——暴露目标环境身份验证中的所有漏洞。在本章中，我们将了解各种形式的身份验证是如何执行的，以及如何最好地测试它们。在此过程中，我们将了解以下主题：

*   了解如何在基本、基于表单或基于摘要的方法中实现 HTTP 身份验证，以及每种方法的优缺点
*   使用 Burp Suite 的入侵者模块绕过这些认证墙
*   讨论**双因素认证**（**2FA**的影响及克服途径
*   了解功能级访问控制是如何工作的，它如何被错误配置，以及如何通过伪造来利用
*   讨论暴力和字典攻击的可能性

## 敲门敲门，谁在那里？

* * *

身份验证是确定某人是谁的一门艺术，并且是确定无疑的。自从网络出现以来，这个过程就变得很危险，因为错误地处理这个过程可能会危及环境的其他部分。尽管存在潜在的影响，但这种风险往往在非安全人员身上消失——用户的便利再次导致安全性的放松。OWASP 将其列为网络安全中第二大最紧迫的威胁，并将其描述为具有严重影响，如以下屏幕截图所示：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_01.png)

断开身份验证和会话管理的 OWASP 摘要

### 认证一定很难吗？

大多数身份验证方法都以存在有效用户为前提，这些用户通常具有需要访问某些内容的不同权限级别。现在，我们如何确认他们是他们所说的人？这些所谓的**凭证**非常类似于物理安全措施。合适的人都会看起来像他们说的那样，并且希望有合适的答案来应对挑战。过去，基于用户名和密码的身份验证是完全可以接受的，但现在，这种有缺陷的单因素方法不再能够保证客户端连接的可靠性。

近年来，网站和应用程序都加入了所谓的 2FA 以提高保真度。2FA 在所需的身份验证检查中添加了第二个因素，大大降低了被盗凭证成功获得非法访问的可能性。这些因素通常被描述为你是谁（例如用户名或电子邮件）、你知道的东西（密码或密码短语）和你拥有的东西（通常是软令牌、RSA 密钥或其他**一次性密码**（**OTP**）。在认证使用的前提下，我们甚至可以看到指纹、视网膜扫描和其他生物特征。再加上安全问题、**验证码**或其他图片验证技术，甚至证书，我们可以看出为什么这足以压倒那些为方便使用而不是测谎测试而使用目标应用程序的用户。

以下屏幕截图显示了一种通用的身份验证方法：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_02-1.png)

网站的通用认证方法

### 鉴权 2.0——抢夺金票

如果你熟悉罗尔德·达尔（Roald Dahl）的优秀书籍《查理与巧克力工厂》（Charlie and the Chocolate Factory），你就会知道，孩子们在糖果棒中发现的**金券**为他们打开了一些非常独特的大门，甚至帮助查理·巴特（Charlie Bucket）赢得了终极大奖。虽然我们的目标可能不会给受害者糖果，但他们正在发行他们自己的*票——*代币，提供持续和特权访问。对我们来说，诀窍在于理解如何利用这一点。

为解决用户群体的工作密集型身份验证难题而开发的解决方案需要改进。最初尝试将用户与会话关联时，web 开发人员在身份验证后的数据包中嵌入了唯一的会话 ID 代码，以记住用户、跟踪他们的活动并提供维护访问。这些有状态的密钥过去没有保护，有时仍然没有保护；黑客要么窃取并重新使用这些会话，要么使用**会话固定**欺骗用户，使用包含会话 ID 的恶意重定向使攻击者创建的会话 ID 或令牌合法化，然后对其进行身份验证。保护这些 ID 的努力已经取得了很大的进展，我们现在看到使用的加密令牌既掩盖了令牌本身，甚至使用客户端脚本来帮助确保关系的完整性。

### 注

不管可用的对策是什么，应用程序开发人员都是习惯性的生物，他们会使用 cookie 和代币来携带各种敏感信息。作为一名测笔员，这听起来很有趣！

有三种方法通常用于提取和传输凭据：基本身份验证、基于表单的身份验证和基于摘要的身份验证。下表有助于我们了解各自的优势、劣势、应用和特殊注意事项：

<colgroup class="calibre14"><col class="calibre15"> <col class="calibre15"> <col class="calibre15"> <col class="calibre15"></colgroup> 
|  | **强度** | **弱点** | **典型应用** |
| **基础** | 通常 SSL/TLS 是加密的。 | 这很容易使用客户端脚本，如果没有正确加密，则很容易捕获 | 

*   网络美国石油学会
*   移动应用持久化

 |
| **基于表单的** | 对用户的干扰最小 | 这很可能是不受保护的、推断数据库内容或暴露未使用的字段 | 

*   网站和门户上的传统凭证挑战。

 |
| **基于摘要的** | 基本+机器哈希 | 这是相对安全的�� 就目前的技术水平而言，它是最好的 | 

*   网络美国石油学会
*   移动应用持久化

 |

让我们看看用户在他们的终端看到了什么，然后我们就可以开始攻击了！

#### 基本认证

一些网站将允许用户凭据通过 HTTP 请求本身中为此目的保留的字段传递到身份验证 web 服务器。这称为基本身份验证，可以通过用户输入进行配置，也可以通过在客户端脚本或浏览器插件中实现的预配置配置文件进行配置。虽然这看起来有点太容易攻击，但如果操作正确，该机制通常会受到 TLS 加密的保护，实体都在利用证书提供更大的确定性。这在运营商和支持人员使用的**应用程序编程接口**（**API**）和公司内部网应用程序中非常常用，一些移动应用程序将使用此技术来维护对其服务器的安全访问。

#### 基于表单的身份验证

尽管有一个基本的身份验证，但大多数用户将熟悉不同的表单作为默认的面向用户的方法。对于用户将看到的内容，基于表单的身份验证是不言自明的。向客户端发出的身份验证质询是一种形式，通常需要用户名或电子邮件地址，至少需要密码或密码短语。在大多数情况下，没有对服务器进行验证和身份验证——基于表单的身份验证假定服务器是受信任的设备。这是攻击者容易利用的一个相当大的弱点。

提交时，用户提供的变量实际上是带外执行的，因为它们与 HTTP 请求本身有关，作为一些封装数据而不是使用内置的 HTTP 身份验证规定。黑帽黑客也会发现这些提交值得瞄准，因为一个用户的有效凭证可以提供足够的空间，让他们能够发起一系列其他攻击，并避免伪装成真正经过身份验证的用户的多层保护。

#### 基于摘要的认证

基于摘要的身份验证采用基本身份验证的基础，但应用 MD5 哈希和 nonce 有望提供比仅使用基本身份验证更高的安全性。nonce 类似于 OTP 的机器版本——一个只应用一次且有效的数字，以使哈希对重播攻击免疫。

### 信任但验证

公众对基于凭证的简单身份验证的局限性的认识终于开始跟上，因为许多人现在需要在身份验证过程中使用其他因素。2FA 现在已成为主流，虽然它开始在企业 VPN 中使用，但它现在已扩展到各种各样的应用程序，甚至消费产品和服务。谷歌、Dropbox、Facebook 以及它们的竞争对手——所有这些公司现在都在提供不同形式的 2FA，以帮助保护用户安全，减少公司受到不良宣传的风险。此处列出了一些其他因素（除了密码之外）：

*   **硬件代币**：第一项措施之一，几家公司提供的硬件代币明确发放给员工或承包商，并显示时间代码，这将提供第二个因素。随着其他更容易部署的机制的出现，这些机制的数量有所下降。
*   **一次性密码**（通过可信设备）：如今在消费者和企业应用程序（如下面截图中的 Dropbox）中都有很大的用途，这种技术是硬件令牌的软件版本。除了通过文本、SMS 或电子邮件提供代码外，许多应用程序还允许 OTP 与 Google Authenticator、PingID 等应用程序同步。

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_03.png)

Dropbox 2FA 正在运行

*   **智能卡**：这些卡通常出现在更严格的环境（政府、国防等）中，在这些环境中，不仅要防止对应用程序的访问，还要防止对运行应用程序的工作站或设备的访问。通常，一种支持智能芯片的卡，存在使用 USB 加密狗、磁性令牌和老式机械钥匙的实现。
*   **生物识别**：生物识别扫描和测试作为 2FA 的最新补充，长期以来一直是物理访问控制的关键要素。常见的测试包括指纹或手印扫描、视网膜扫描、语音识别，而现在，甚至面部识别也开始悄悄进入现场。一些移动设备制造商和现在的金融应用程序正在利用面部和语音识别来解锁设备，并为移动应用程序提供额外的因素。

与前面的方法相比，安全性要低得多，以下附加信息通常被遗留应用程序或自定义身份验证门户用于阻止暴力尝试或模糊。话虽如此，这些方法也被攻击者无情地利用，因为它们都是社会工程攻击的常见素材，容易从无关紧要的信息泄漏中提取出来，缺乏时间敏感性，有时在黑暗网络上作为受损帐户列表的一部分可用。如果正在使用这些方法，则应将其添加到上述方法中更为硬化的 2FA 方法之外：

*   **安全问题**：常见问题列表中的一个或多个问题是典型的，考虑到这些问题多年来一直被用于跨攻击的验证，它们几乎与黑暗网络上泄漏转储的用户名一样普遍。用户通常在多个服务中以类似方式回答这些问题，这些问题通常是帐户恢复过程的一部分。如果攻击者在此处猜测答案或购买答案，则很有可能出现重大的多站点漏洞。
*   **图片召回**：一些应用程序将更传统的凭证与记忆图片相结合，要求用户从随机场景或对象中进行选择，并希望用户在将来登录时记住这些内容。这种保护还可以防止自动暴力尝试和模糊，因为需要空间输入。不管是什么样的人类行为，用户都会选择代表他们兴趣的图片。社会工程可以大大提高猜测的机会。
*   **账户信息**：*增强*认证的最早形式之一是门户从账号、地址或电话号码中请求数字。我希望这是不言而喻的，但如果这是我们的客户对 2FA 的想法，那么他们非常需要一些有效的渗透测试和关于适当安全性的后续指导。

## 这是您正在寻找的课程

* * *

现在我们已经看到了 Web 应用开发人员试图使我们的工作变得困难的所有方式，让我们来看看我们如何测试他们做得如何。我们将看到有几个地方可以攻击信任链，测试会话管理机制的弹性，并学习如何克服它们。

### 嚼着饼干？

大多数攻击者和 pen 测试人员会发现，会话信息的草率管理通常是破坏应用程序的最简单途径。Cookie 是会话信息的一个相当宽泛的术语，拦截和篡改这些信息可能是一笔意外之财。Burp Suite 非常适合使用其**代理拦截**和**中继器**功能来帮助实现这一点。对于本测试，我们将首先通过 Firefox 登录我们的**Mutillidae**应用程序**`A2 - Broken Authentication and Session Management`****`Privilege Escalation`****`Login`**页面（如下截图所示）：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_04.png)

选择 Multillidae 会话管理实验室

对于这个测试，让我们继续使用我们刚刚偶然发现的一些凭证（通过社会工程或[第 7 章](Mastering%20Kali%20Linux%20for%20Web%20Penetration%20Testing_split_000.html#)、*注入和溢出测试*中涵盖的各种方法），并输入`user`用户名和密码。一旦我们通过身份验证，我们将打开**代理截获**并刷新页面，允许我们捕获 HTTP 消息（如以下屏幕截图所示）及其包含的 cookie 数据：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_05.png)

将 cookies 定位为 fuzz

我们可以清楚地看到，web 开发人员试图对 cookie 进行大量操作，但不知怎么地忘记了保护 cookie。我们可以看到会话的用户名、用户 ID（`uid`）和 PHP 会话 ID（`PHPSESSID`）都包括在内，并且似乎没有与会话相关联的超时（`max-age=0`）。让我们把这个请求传递给我们的打嗝复示器，看看我们能造成什么样的伤害。右键点击事件，点击**`Send to Repeater`**将请求加载到**`Repeater`**工具中；点击现在突出显示的选项卡，并选择**`Params`**选项卡以显示以下屏幕截图中显示的选项：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_06.png)

使用 Repeater 工具进行 Cookie

正如您希望看到的，cookie 本身中的参数可以更改（由橙色字段概括）。我们还可以添加或删除 cookie 的所有部分（使用绿色的适当按钮），以确定它们对会话完整性的重要性和影响。当我们逐步进行修改时，我们可以查看右侧（使用**`Response`**部分中的**`Render`**选项卡）以查看操作的最终结果（在本例中，状态更改为登录状态和用户名，用红色勾勒）。如果你走得太远，剥去或改变太多，就没有必要担心了——后退和前进按钮可以帮助你根据需要来回查看影响。

在这种情况下，UID 和 PHPSESSID 都能够独立地维护会话的状态（如下面的屏幕截图所示），这意味着只有当您同时从请求中删除这两者时，您才会丢失会话并看到注销。

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_07.png)

在 cookie 中使用基本组件维护状态

这也意味着每个用户只有一个有效会话，但如果需要，您可以轻松地创建自己的经过身份验证的会话。哎呀，我想知道我们现在真正想成为什么样的用户？好的，假设默认的 SQL、XML 或其他用户表格式已经就绪，并且没有进行强化，我们可以在下面的屏幕截图中尝试一些更理想的内容：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_08.png)

模糊 UID 以提供管理

正如您所看到的，这个简单的示例帮助您通过使用 Burp Suite 的**`Repeater`**工具中的一些有趣的技巧来操作 cookie 的组件，从而获得根。当然，这需要我们捕获经过身份验证的会话。但是，如果我们还没有一个，或者我们想欺骗用户解锁我们可能会遇到的所有 2FA 陷阱，该怎么办？

### 不要吃毛茸茸的饼干

当一个 cookie 需要工作时，**`Repeater`**的更为手动的过程可能非常有意义。然而，当我们试图强行使用 cookie 时，它可以更好地利用我们的时间使用 Burp Suite 的 Sequencer，因为它可以帮助我们分析应用程序维护会话随机性的程度。

要做到这一点，我们需要访问一个应用程序并捕获一个带有会话 ID 的请求。在单机版**该死的易受攻击的 Web**（**DVWA**）应用程序（单机版，而不是 OWASP BWA 捆绑版，它不会适当地公开 cookie）。让我们抓取一个合适的请求，右键单击事件，然后点击**`Send to Sequencer`**，类似于下面的屏幕截图：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_09.png)

查找要排序的正确请求

在**`Sequencer`**选项卡中，我们可以开始突出显示我们想要随机选择**`Sequencer`**的字段，如下面的屏幕截图所示。对于这个测试，我们真正感兴趣的是应用程序对 PHPSESSID 的随机化程度，因此我们将相应地选择它，然后单击按钮**`Start Live Capture`**：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_10.png)

配置序列器

这将弹出一个特殊窗口，允许您查看完成了多少次迭代。在您运行它至少 100 次或更多次迭代之后，您可以停止该过程或继续迭代；同时，您还可以运行随机性分析。如果一个应用程序在这方面得分很低，这就意味着我们有机会模糊会话密钥并劫持映射到该会话的可怜用户的访问权限。在下面的屏幕截图中，我们可以看到当我让测试运行到 5700 多个会话（只需要几分钟）时的情况：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_11.png)

会话随机性的序列分析

如果我们想为下一个会话中讨论的潜在会话固定候选对象保存 cookie，我们可以将它们放入一个文件中并保存以备将来使用。

会话随机化是一个很好的指标，可以反映应用程序的构建情况以及客户开发人员的安全意识。还记得我们讨论过 web 开发人员使用 Cookie 不仅仅是为了存储会话 ID 吗？sequencer 在 web 应用程序笔测试中有许多其他应用程序，因为令牌不仅仅用于跟踪会话状态。Burp Suite 的文档非常有助于理解该工具的其他功能（可在**`Help`**菜单中找到）和 Packt 手册*Burp Suite Essentials*（[中找到）https://www.packtpub.com/hardware-and-creative/burp-suite-essentials](https://www.packtpub.com/hardware-and-creative/burp-suite-essentials) 可能是一个很好的资源。

### 绝地会议技巧

黑帽子针对自定义身份验证前端的常见攻击是会话固定。黑客依赖于这样一个事实，即开发人员没有考虑如何充分保护和排序他们的会话 ID。通过社会工程（一封简单的电子邮件或即时消息就可以了），黑客能够发送一个带有预设无效会话 ID 的 URL 字符串。如果这是我们的测试，我们肯定希望其他一些流量用作模板，或者从扫描或隐蔽收集中了解应用程序，这样我们就能够提供应用程序所期望的会话 ID 格式和长度。不正确配置的认证门户将允许我们的受害者携带他们自己的会话 ID（ha！BYOSID？），并且，通过认证他们自己的凭据，甚至 2FA，他们将会话 ID 合法化。我们测试人员等待，然后可以使用这个新的合法会话 ID 疯狂运行并冒充受害者。

一个安全的应用程序可以通过确保使用的会话 ID 或 cookie 随身份验证而改变来防止这种情况造成损害，但事实证明，这并不像我们希望的那样标准。这在网上购物网站中也很常见，这是相当危险的，因为合法用户可能只需一次快速的社会攻击就可以获得支付信息。执行会话固定攻击的常用方法如以下屏幕截图所示：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_12-1.png)

会话固定的一般方法

当然，最容易使用这种攻击的站点可能是那些使用会话 ID 或 cookie 作为 URL 字符串一部分的站点。然而，我们通常需要通过一些巧妙的客户端脚本或元标记包含来设置 cookie。OWASP BWA VM 上包含的**WebGoat**应用程序是实践整个过程的一个很好的方式，从生成虚假链接到欺骗用户进行身份验证，从而使其合法化，最终结果类似于下面的截图，其中 Joe Hacker 通过钓鱼受害者 Jane，能够让她使用他的会话 ID 进行身份验证，然后跟随她获得完整的帐户访问权限：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_13.png)

使用 WebGoat 练习会话固定

这其中最可怕的部分可能是，一旦进入帐户，Joe Hacker 实际上可以强制更改帐户密码，重新路由银行交易，并将用户锁定在外！许多保险、人力资源和金融网站很少被普通员工使用，因此黑客通常可以有一个月或更长的时间在账户通知告知受害者之前采取行动。

## 功能访问级别控制

* * *

到目前为止，我们谈论的大多数技术和关注点都是针对坏人（或我们）获取他们本不应该拥有的*信息*。在 OWASP 2013 前 10 名中（[https://www.owasp.org/index.php/Top_10_2013-A4-Insecure_Direct_Object_References](https://www.owasp.org/index.php/Top_10_2013-A4-Insecure_Direct_Object_References) ），这被称为**不安全直接对象引用**（**IDOR**），在列表中排名第 4。然而，还有另一个问题，过去是列表中的第 7 位，称为**缺少功能访问级别控制**（**[https://www.owasp.org/index.php/Top_10_2013-A7-Missing_Function_Level_Access_Control](https://www.owasp.org/index.php/Top_10_2013-A7-Missing_Function_Level_Access_Control)** ，在下面的屏幕截图中捕获了 2013 年的 OWASP 摘要。该类别意味着要解决无意或不适当地向攻击者披露*功能*，而不是*信息*。

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_14.png)

OWASP 2013#7 威胁：缺少功能访问级别控制

在大多数情况下，当简单地尝试访问隐藏页面或尝试在不应具有这些权限的已验证会话中隐藏命令时，就会发现这种缺陷。Web 开发人员可能会将模糊处理误认为是安全性问题，而不是与策略引擎搏斗，他们只是依赖于从视图中隐藏函数或命令，而不是显式地阻止它们的使用。使用 Burp 套件或 OWASP ZAP 进行扫描可以快速找到目标站点中值得测试的候选区域，扫描过程甚至可以提供问题的部分验证。

## 精炼野兽的词汇

* * *

我们在上面看到的许多攻击都试图劫持会话，诱骗用户代表他们建立会话，或者利用应用程序无法强制执行其周围的规则。最后，我们将找到一个案例，我们需要解决房间里的大象，然后猜测密码。有太多的工具可以尝试这项非常基本的任务，但一般来说，它们都是以同样的方式进行的——通过使用全暴力引擎（例如，使用**crunch**）生成的单词表、精炼的单词表和音节引擎（**开膛手约翰**、**THC Hydra**生成的单词表进行迭代，等等），甚至使用预灰化的解决方案（使用彩虹表和类似的表）。

对于 Web 应用程序，Burp Suite 是一个很好的暴力攻击工具，您可以参考[第 5 章](Mastering%20Kali%20Linux%20for%20Web%20Penetration%20Testing_split_000.html#)、***和**使用 OWASP ZAP 和 Burp Suite*进行代理操作，了解如何使用该工具，并仅对密码字段应用相同的模糊技术。我们还可以使用 THC Hydra 等工具对 web 登录页面进行暴力攻击。当习惯 THC Hydra 的功能和格式时，练习使用**xHydra**GUI 前端是很有帮助的。要使用 xHydra（也称为**hydra gtk**，您可以使用以下屏幕截图所示菜单中的快捷方式或在 CLI 中键入`xhydra`来调用流程：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_15.png)

查找 Hydra 的 GUI 前端

一旦打开 Hydra 的 GUI，我们就可以开始配置解决目标所需的选项。**`Target`**选项卡（如以下屏幕截图所示）允许我们指向正确的 IP 或主机名，识别我们要针对的请求提交类型（在本例中为`http-post-form`），甚至切换日志记录、调试和详细模式：

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_16.png)

Hydra 目标信息

在**`Passwords`**选项卡中（如下图所示），我们可以配置 hydra 使用单一提交或从列表中提取用户名和密码。许多缺少密码复杂性规则的应用程序允许用户在某些帐户中使用用户名或空格，因此提供了复选框，允许我们检查这些帐户。**反向登录**允许您尝试反转用户名顺序，并尝试将其作为密码。

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_17.png)

设置用户名和密码列表

我们最后的调整将出现在**`Specific`**选项卡中（如下面的屏幕截图所示）。这里定义了我们正在测试的非常重要的 URL 模式。我们填写的字段需要从您浏览器上的**`View Source`**中、浏览器的插件或使用 Burp Suite 的代理截取来收集。在任何情况下，**`Passwords`**选项卡填充的变量都将标记为`^USER^`和`^PASS^`。最后一个字符串实际上是表示身份验证失败的任何标识字符串。在 DVWA 中，字符串将在返回的结果中看到`login.php`，从而将我们推向相同的登录门户。如果我们将此应用于 Mutillidae，我们可以使用`Not Logged In`。

目标的适用 URL——答案因站点而异，这些信息通常是通过扫描、爬网或老式冲浪收集的。

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_18.png)

指定被评估的 URL

我们的最后一步是从**`Start`**选项卡实际运行扫描（如下面的屏幕截图所示）。我们可以看到扫描迭代——多亏了我们的 verbose 标志，任何成功的结果都将在输出的底部声明。我们还可以看到与 GUI 配置相当的 CLI，以便您可以作为脚本的一部分重复这些扫描，或者在 CLI 中进行调整。一句警告或澄清的话——我发现 CLI 很挑剔，因为它有问题，这取决于我使用的 URL 字符串的格式，或者为选项添加的顺序标志有时会产生非常不同的结果。使用 GUI 工具消除了许多不确定性，是避免这些陷阱的好方法。

![](https://www.packtpub.com/img/9781784395070/img/B03918_09_19.png)

查看 Hydra 结果和命令行版本

Hydra 作为一种专门构建的暴力工具，是解决网络和非网络凭证黑客问题的一种非常好的方法。古老的谚语*垃圾输入，垃圾输出*也适用于这里——我们的结果只会与输入工具的密码和用户列表一样好，因此我建议探索更好地组织您的 OSIT 收集的方法。熟悉 Kali 附带的各种工具中的单词列表，熟悉像**Crunch**（[这样的工具 https://sourceforge.net/projects/crunch-wordlist/](https://sourceforge.net/projects/crunch-wordlist/) 和**CeWL**[https://digi.ninja/projects/cewl.php](https://digi.ninja/projects/cewl.php) 帮助生成单词列表。还值得研究基于散列的攻击，它允许我们避免对密码进行加密散列，并更多地利用**单点登录**（**SSO**）、**开放身份验证**（**OAuth**），以及 Microsoft AD 环境中常用的混合身份验证体系结构。这些基于散列的方法（如**传递散列**：**[https://www.sans.org/reading-room/whitepapers/testing/pass-the-hash-attacks-tools-mitigation-33283](https://www.sans.org/reading-room/whitepapers/testing/pass-the-hash-attacks-tools-mitigation-33283)** 在系统测试范围内的全套渗透测试中更有意义。

## 总结

* * *

身份验证是 web 上信任的基础。这方面的妥协可能不像在应用程序的其他方面那样浮华，但影响是至关重要的。身份验证或会话管理中断会使所有其他安全措施变得毫无意义。让客户了解这一点很重要，但我们需要提倡更多地采用时态 2FA，重新使用标准化且易于理解的框架，而不是自行开发的门户，并在软件开发生命周期的所有阶段持续进行渗透测试，以确保应用程序的成熟不会导致可信、强化的身份验证未完成。

在本章中，我们了解了 web 应用程序如何通过多种方式识别和验证用户并分配权限。我们现在有了工具，可以测试应用程序中会话管理的弹性，也可以先测试充电头以获取凭据。Burp Suite、Hydra、OWASP ZAP，当然还有您的浏览器和一些 OSIT，在验证目标的强化方面会非常有用。

在[第 10 章](Mastering%20Kali%20Linux%20for%20Web%20Penetration%20Testing_split_000.html#)*启动客户端攻击*中，我们将把客户端攻击提升到一个新的层次，重新审视基于 DOM 的跨站点脚本。您还将学习如何利用客户端发起攻击、提升我们的权限、代表您劫持通信，甚至了解神秘的跨站点请求伪造。我们在原地踏步，伙计们，我很高兴你们还和我在一起！让我们向前冲，选择一些浏览器。
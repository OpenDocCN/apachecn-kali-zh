# 十三、PCI DSS 扫描和渗透测试

**支付卡行业数据安全标准**（**PCI DSS**）于 2006 年由多家领先的信用卡公司合资成立，包括万事达卡、Discovery、Visa、美国运通和 JCB International。PCI DSS（目前版本为 3.2.1）适用于所有接受、处理、传输和存储信用卡信息及相关详细信息的机构、商户和企业。本标准的目的仅在于保护商户、服务提供商和消费者免受因违反信用卡和相关**个人识别信息**（**PII**数据安全而可能遭受的财务和商誉损失。

根据 PCI DSS，持卡人数据包括：

*   持卡人的姓名
*   持卡人的账号
*   持卡人的服务代码
*   卡的有效期

敏感数据还包括**个人识别号**（**引脚**）以及在磁条或芯片上发现的数据。

PCI DSS 包括 6 个目标和 12 个要求。所有 6 项目标和 12 项要求都可以通过深入评估来实现，该评估验证已采取措施积极确保持卡人信息的保护。虽然满足 6 个目标和 12 项成就听起来很简单，但实际上有 250 个 PCI 子需求。

根据万事达卡，PCI DSS 的六个目标如下：

*   建立和维护安全的网络和系统
*   保护持卡人数据
*   维护漏洞管理程序
*   实施强有力的访问控制措施
*   定期监测和测试网络
*   维护信息安全策略

处理的持卡人交易量决定了公司需要完成的评估类型。一些公司，如 Discover Global Network（Discover 卡的）要求所有使用 Discover 网络处理、传输或存储持卡人数据的商户都符合 PCI 标准。

信用卡机构有不同的级别和类别，它们根据这些级别和类别确定合规要求，如下一节所列。各机构的标准各不相同，但所有机构的要求相同：

*   **1 级**：必须提交年度现场安全评估报告，详细说明处理、存储或传输信用卡信息的评估系统。还需要每季度进行一次网络扫描，必须由**批准的扫描供应商**（**ASV**进行，以远程扫描漏洞和潜在威胁。
    *   美国运通年交易量：250 万（或更多）
    *   万事达卡年交易量：600 万或以上
*   **二级**：50000-250 万。需要进行年度自我评估，以及季度网络扫描。也可由商户自行决定提供现场评估。
    *   美国运通年交易量：少于 50000
    *   万事达卡年交易量：100 万至 600 万
*   **第 3 级**：需要每年进行一次自我评估，同时每季度进行一次网络扫描。也可由商户自行决定提供现场评估。
    *   美国运通年交易量：少于 50000
    *   万事达卡年交易量：超过 20000，但不到 100 万

其他级别：

*   **级别 EMV（美国运通）**：处理超过 50000 个芯片支持的卡交易需要每年进行一次 EMV 认证（AEA）自检。
*   **第 4 级（万事达卡）**：需要每年进行一次自我评估，同时每季度进行一次网络扫描。也可由商户自行决定提供现场评估。

# PCI DSS v3.2.1 要求 11.3

在本章前面，我提到 PCI DSS 包括 6 个目标和 12 个需求。官方 PCI DSS v3.2.1 快速参考指南提供了所有需要满足的 12 项要求的摘要，可在[下载 https://www.pcisecuritystandards.org/documents/PCI_DSS-QRG-v3_2_1.pdf?agreement=true &时间=1535479943356](https://www.pcisecuritystandards.org/documents/PCI_DSS-QRG-v3_2_1.pdf?agreement=true&time=1535479943356)。在本节中，我们将重点介绍在*要求 11：定期测试安全系统和流程*下的 PCI DSS 评估的渗透测试元素，该要求属于*目标 5：定期监控和测试网络。*

要求 11.3 基于实施渗透测试方法，如建议的*NIST SP800-115《信息安全测试和评估技术指南》*。尽管于 2008 年发布，NIST SP800-115 为确定渗透测试的范围和执行渗透测试提供了久经考验且值得信赖的技术和最佳实践，并且在考虑或创建渗透测试方法时应作为指南。

要求 11.3.1 侧重于执行外部渗透试验。这应该每年进行一次，或者在组织内部进行任何有影响力的重大升级之后进行，例如服务器、主干应用、交换机、路由器、防火墙、云迁移，甚至环境中的操作系统升级。外部渗透测试应由合格且经验丰富的人员或第三方进行。

要求 11.3.2 侧重于内部渗透测试。根据要求 11.3.1，内部渗透试验应每年进行一次，并由合格且经验丰富的个人或第三方进行。

要求 11.3.3 更多地是一项分析性要求，而非技术性要求，因为它涉及对内部和外部渗透测试的分析，以确保缓解暴露的漏洞和利用漏洞。

要求 11.4 定义了方法范围内的细分。在确定评估范围时（我们将在下一节中看到），强烈建议减少评估范围，因为并非网络或 CDE 中的每个系统都需要评估。这种类型的网络隔离可以使用路由器中的防火墙和访问控制列表配置来完成。

# 确定 PCI DSS 渗透测试的范围

在进行任何类型的渗透测试之前，渗透测试人员需要与客户接洽，以确保获得所有适当的信息。在目标范围界定阶段，渗透测试人员将从客户处收集信息，这些信息将用于生成目标评估需求、定义测试参数以及客户的业务目标和时间表。这一过程在为任何类型的安全评估确定明确目标方面起着重要作用。通过确定这些关键目标，您可以很容易地绘制出一个实用的路线图，其中包括将测试什么、如何测试、将分配什么资源、将应用什么限制、将实现什么业务目标以及如何计划和安排测试项目。所有这些信息最终都被捕获到一个测试计划中，该计划明确规定了测试的范围。

我们可以将所有这些元素结合起来，并在一个正式的范围过程中呈现它们，以实现所需的目标。以下是本章将讨论的关键概念：

*   **收集客户需求**：通过口头或书面沟通，收集目标环境的相关信息。
*   **准备测试计划**：这取决于不同的变量集。这些变量可能包括将实际需求形成结构化测试过程、法律协议、成本分析和资源分配。
*   **剖面测试边界**：确定与渗透测试任务相关的限制。这些可能是技术、知识的限制，也可能是对客户 IT 环境的正式限制。
*   **定义业务目标**：这是一个将业务视图与渗透测试计划的技术目标相一致的过程。
*   **项目管理和进度安排**：这指导渗透测试过程的每一个其他步骤，并为测试执行提供适当的时间表。这可以通过使用许多高级项目管理工具来实现。

强烈建议您遵循范围界定过程，以确保测试的一致性和更大的成功概率。此外，该过程还可以根据给定的情况和测试因素进行调整。如果没有任何这样的过程，失败的可能性会更大，因为收集的需求将没有合适的定义和程序可遵循。这可能会使整个渗透测试项目处于危险之中，并可能导致意外的业务中断。在这一阶段，特别关注渗透测试过程将对测试的其余阶段做出卓越的贡献，并澄清技术和管理领域的观点。关键是事先从客户处获取尽可能多的信息，以制定反映渗透测试多个方面的战略路径。这些可能包括可协商的法律条款、合同协议、资源分配、测试限制、核心能力、基础设施信息、时间表和接洽规则。作为最佳实践的一部分，范围过程解决了以专业方式启动渗透测试项目所需的每个属性。

每个步骤都构成了唯一的信息，这些信息按照逻辑顺序排列，以便成功地执行测试。这也适用于任何需要在早期解决的法律问题。因此，我们将在下一节中更详细地解释这些步骤。请记住，如果以有组织的方式管理收集的所有信息，客户和渗透测试顾问将更容易进一步了解测试过程。

# 收集客户需求

这一步提供了一个通用指南，可以以问卷的形式绘制，以便从客户端设计出有关目标基础架构的所有信息。客户可以是与目标组织有法律和商业约束力的任何主体。因此，为了渗透测试项目的成功，在项目的早期阶段识别所有内部和外部利益相关者，并分析他们的兴趣、期望、重要性和影响水平至关重要。然后，可以制定一项战略，以接近每个利益相关者，了解他们的需求和参与渗透测试项目的情况，从而最大限度地发挥积极影响，缓解潜在的消极影响。

在采取任何进一步措施之前，渗透测试人员完全有责任验证缔约方的身份。

收集客户要求的基本目的是打开一个真实可信的渠道，通过该渠道渗透测试人员可以获得测试过程中可能需要的任何信息。一旦确定了测试要求，客户应验证这些要求，以消除任何误导性信息。这将确保未来测试计划的一致性和完整性。

# 创建客户需求表单

我们列出了一些常见问题和注意事项，这些问题和注意事项可作为创建常规客户需求表的基础。需要注意的是，此列表可以根据客户的目标进行扩展或缩短：

*   收集基本信息，如公司名称、地址、网站、联系人详细信息、电子邮件地址和电话号码
*   确定渗透测试项目背后的关键目标
*   确定渗透试验类型（有或无特定标准）：
    *   黑盒测试
    *   白盒试验
    *   外部测试
    *   内部测试
    *   包括社会工程
    *   社会工程除外
    *   调查员工背景信息
    *   采用员工的假身份（可能需要法律顾问）
    *   包括拒绝服务
    *   拒绝服务除外
    *   渗透业务伙伴系统：
        *   需要测试多少服务器、工作站和网络设备？
        *   您的基础架构支持哪些操作系统技术？
        *   哪些网络设备需要测试？防火墙、路由器、交换机、负载平衡器、IDS、IP 或任何其他设备？
        *   灾难恢复计划是否到位？如果是，我们应该联系谁？
        *   目前是否有管理员管理您的网络？
        *   是否有遵守行业标准的具体要求？如果是，请列出它们。
        *   谁将是这个项目的联系人？
        *   为该项目分配的时间表是什么？
        *   你对这个项目的预算是多少？
        *   如有必要，列出任何其他要求。

# 准备测试计划

一旦客户收集并验证了这些要求，就应该制定一份正式的测试计划，除了测试过程的法律和商业基础上的其他必要信息外，还应反映所有这些要求。编制测试计划涉及的关键变量包括结构化测试流程、资源分配、成本分析、保密协议、渗透测试合同和参与规则。每个领域都有简短的描述，如下所示：

*   **结构化测试流程**：在分析了客户提供的详细信息后，重构测试方法可能很重要。例如，如果社会工程服务即将被排除在外，您必须将其从正式测试过程中删除。有时，这种做法被称为**测试过程验证**。这是一项重复性任务，每当客户需求发生变化时，都必须重新审视。如果在测试执行过程中涉及任何不必要的步骤，可能会导致违反组织的政策，并招致严重的处罚。此外，根据测试类型，测试过程会有很多变化。例如，白盒测试可能不需要信息收集和目标发现阶段，因为测试人员已经知道内部基础结构。

无论测试类型如何，网络和环境数据的验证都可能有用。毕竟，客户可能不知道他们的网络到底是什么样子的！

*   **资源分配**：确定完成测试所需的专家知识是最重要的领域之一。因此，为某项任务指派适当熟练的渗透测试人员可能会导致更好的安全评估。例如，应用的渗透测试需要一个知识渊博的应用安全测试人员。该活动对渗透测试任务的成功起着重要作用。
*   **成本分析**：渗透测试的成本取决于几个因素。这可能涉及完成项目范围分配的天数、附加服务要求（如社会工程和物理安全评估）以及评估特定技术所需的专家知识。从行业角度来看，这应该结合定性和定量价值。
*   **保密协议**（**保密协议**）：在开始测试流程之前，有必要签署一份反映双方利益的保密协议：客户和渗透测试人员。使用此类共同保密协议应澄清测试应符合的条款和条件。渗透测试仪应在整个测试过程中遵守这些条款。违反任何单一的协议条款都可能导致严重的处罚或被永久开除。
*   **渗透测试合同**：始终需要一份法律合同来解决客户和渗透测试人员之间的技术和业务问题。这就是渗透测试合同的意义所在。此类合同中的基本信息侧重于提供哪些测试服务、其主要目标、如何进行测试、付款申报以及维护整个项目的机密性。强烈建议您由律师或法律顾问创建此文档，因为它将用于大多数渗透测试活动。
*   **参与规则（ROE）**：渗透测试过程可能具有侵入性，需要清楚了解评估的需求、客户提供的支持以及每种评估技术可能产生的潜在影响或影响的类型。此外，渗透测试过程中使用的工具应明确说明其用途，以便测试人员能够相应地使用。ROE 以更详细的方式定义了所有这些声明，以解决测试执行期间应遵循的技术标准的必要性。您不应跨越事先约定的 ROE 范围内设定的边界。

通过准备测试计划的每个子部分，您可以确保对渗透测试过程有一致的看法。这将为渗透测试人员提供根据客户要求处理的更具体的评估细节。始终建议您准备一份测试计划清单，用于与缔约方核实评估标准及其基本条款。下一节将讨论一种此类示例性清单。

# 测试计划检查表

以下是在范围流程中采取任何进一步步骤之前应正确回答的一组问题的示例：

*   是否满足 RFP 期间承诺的所有要求？
*   测试范围是否明确规定？
*   是否已确定所有测试实体？
*   是否单独列出了所有非测试实体？
*   是否有任何特定的测试流程需要遵循？
*   测试过程是否正确记录？
*   测试过程完成后是否会产生可交付成果？
*   以前是否对整个目标环境进行过研究和记录？
*   是否分配了与测试活动相关的所有角色和职责？
*   是否有第三方承包商完成特定技术评估？
*   是否已采取任何措施使项目顺利结束？

*   是否已确定灾难恢复计划？
*   测试项目的成本是否已经确定？
*   批准测试计划的人员是否已确定？
*   是否已确定接受测试结果的人员？

# 分析测试边界

理解测试环境的限制和边界与客户需求密切相关，客户需求可以被证明是有意或无意的。这些可以是技术、知识或客户对基础架构施加的任何其他正式限制的形式。施加的每个限制可能会导致测试过程严重中断，并且可以使用替代方法解决。但是，请注意，某些限制不能修改，因为它们由客户管理，以控制渗透测试的过程。我们将讨论每种类型的限制及其相关示例，如下所示：

*   **技术限制**：当一个项目的范围被正确定义时，这种类型的限制就会发生，但是网络基础设施中出现了一种新的技术，使得审核员无法对其进行测试。只有当审核员没有任何渗透测试工具可以帮助评估这项新技术时，才会发生这种情况。例如，想象一下，一家公司推出了一种强大的 GZ 网络防火墙设备，它位于外围，用于保护整个内部网络。然而，它在防火墙内部实现的专有方法阻止了任何防火墙评估工具的工作。因此，始终需要一个能够处理此类新技术评估的最新解决方案。
*   **知识限制**：如果渗透测试人员的技能水平有限且无法测试某些技术，则其知识限制可能会产生负面影响。例如，专用数据库渗透测试人员将无法评估网络基础设施的物理安全性。因此，最好根据相关渗透测试人员的技能和知识划分角色和职责，以实现所需目标。
*   **其他基础设施限制**：客户可以应用某些测试限制来控制评估过程。这可以通过将 IT 基础设施的视图限制为只包括需要评估的特定网络设备和技术来实现。通常，这种限制是在需求收集阶段引入的；例如，测试给定网段后面的所有设备，第一个路由器除外。客户端施加的这种限制首先不能确保路由器的安全性，这可能导致整个网络的安全性受损，即使所有其他网络设备都经过加固并得到安全保证。因此，在对渗透测试施加任何此类限制之前，始终需要进行适当的思考。

分析所有这些限制非常重要，可以在收集客户需求的同时进行。优秀的渗透测试人员的职责是剖析每项要求，并与客户进行讨论，以撤销或更改任何可能导致测试过程中断或在不久的将来导致安全漏洞的模糊限制。这些限制也可以通过引入高技能渗透测试人员和一套先进的评估工具和技术来克服，尽管从本质上讲，某些技术限制无法消除，您可能需要额外的时间来开发他们的测试解决方案。

# 定义业务目标

基于评估要求和服务认可，定义业务目标至关重要。这将确保测试输出以多种方式使企业受益。这些业务目标中的每一个都是根据评估要求进行重点和结构化的，并且可以提供行业寻求实现的目标的清晰视图。我们制定了一些通用业务目标，可用于任何渗透测试任务。但是，它们也可以根据需求的变化进行重新设计。这一过程很重要，可能需要渗透测试人员在测试完成之前、期间和之后观察和理解业务动机，同时保持最低标准。业务目标是将管理和技术团队聚集在一起的主要方面，以支持一个强有力的主张和保护信息系统的想法。根据将要进行的各种安全评估，得出了以下共同目标清单：

*   通过定期进行安全检查，提供全行业的可视性和可接受性。
*   通过确保业务完整性实现必要的标准和合规性。
*   保护保存有关客户、员工和其他商业实体的机密数据的信息系统。
*   列出在网络基础设施中发现的活动威胁和漏洞，并帮助制定安全策略和程序，以防范已知和未知风险。
*   提供平稳稳健的业务结构，使其合作伙伴和客户受益。
*   保留维护 IT 基础架构安全的最低成本。安全评估衡量业务系统的机密性、完整性和可用性。
*   通过消除任何潜在的风险，提供更高的投资回报，如果被恶意对手利用，可能会付出更高的成本。
*   详细说明相关组织的技术团队可以遵循的补救程序，以关闭任何敞开的大门，从而减少运营负担。
*   遵循行业最佳实践和同类最佳工具和技术，根据基础技术评估信息系统的安全性。
*   建议应用于保护业务资产的任何可能的安全解决方案。

# 项目管理和进度安排

管理渗透测试项目需要彻底了解范围界定过程的各个部分。一旦明确了这些范围目标，项目经理可以与渗透测试人员协调，制定一个正式的大纲，定义项目计划和时间表。通常，渗透测试人员可以独立完成这项任务，但客户的合作可能会对进度计划的这一部分给予积极关注。这一点很重要，因为测试执行需要仔细分配不应超过声明的截止日期的时间尺度。一旦确定并分配了适当的资源以在评估期间执行某些任务，就有必要绘制一个时间表，描述这些资源及其在渗透测试过程中的关键作用。

每项任务定义为渗透测试人员承担的一项工作。资源可以是参与安全评估的人员，也可以是实验室设备等普通来源，这有助于渗透测试。为了高效、经济地管理这些项目，有许多可用的项目管理工具可用于实现我们的任务。下表列出了一些重要的项目管理工具。根据环境和测试标准规定，选择最佳的：

| **项目管理工具** | **网站** |
| Microsoft Office Project Professional | [http://www.microsoft.com/project/](http://www.microsoft.com/project/) |
| 时间控制 | [http://www.timecontrol.com/](http://www.timecontrol.com/) |
| 塔斯梅林 | [http://www.taskmerlin.com/](http://www.taskmerlin.com/) |
| 项目 KickStart 专业版 | [http://www.projectkickstart.com/](http://www.projectkickstart.com/) |
| 快速轨道计划 | [http://www.aecsoftware.com/](http://www.aecsoftware.com/) |
| 项目文库 | [www.projectlibre.org](http://www.projectlibre.org) |
| 杂耍者 | [http://www.taskjuggler.org/](http://www.taskjuggler.org/) |

使用这些功能强大的工具，渗透测试人员的工作可以根据其定义的任务和时间段轻松跟踪和管理。此外，这些工具还提供了其他高级功能，例如，如果任务已完成或超过最后期限，则为项目经理生成警报。在渗透测试任务期间，还有许多其他积极因素鼓励使用项目管理工具。这些包括按时提供服务的效率、改进的测试生产率和客户满意度、提高的工作质量和数量以及控制工作进度的灵活性。

# 用于执行 PCI DSS 渗透测试的工具

PCI DSS 规定，年度评估由 ASV 进行，而自我评估可由合格且经验丰富的专业人员每季度进行一次。合格人员应具有多年渗透测试经验，并持有以下一项或多项证书：

*   **认证道德黑客**（**CEH**）
*   **攻击性安全认证专业人员**（**OSCP**
*   **佳洁士**渗透测试证书
*   **全球信息保障**（**GIAC**），例如 GPEN、GWAPT、GXPN。

专业人员用于 PCI DSS 评估的工具可以是商业工具，也可以是开源工具，只要它们能够产生高水平的准确性。在本书中，我们使用了许多工具，其中一些工具不仅可以执行多种功能，而且可以自动执行，通常是在指定了所有 IP 信息之后。

在[第 6 章](06.html)、*漏洞扫描*、*中，我们研究了几种用于执行自动漏洞评估的工具，包括 Tenable's Nessus 的试用版及其用于 PCI DSS 评估和合规性的可用选项。Tenable 也是众多可直接作为独立第三方受雇的公司之一，根据公司的合规水平和年度交易量，为年度 PCI DSS 报告执行 PCI ASV 漏洞扫描。*

 *尽管 Nessus 现在仅通过付费订阅提供，但它还可以执行内部和外部 PCI DSS 评估。以下屏幕截图显示了 Nessus 内部 PCI DSS 评估的详细信息：

![](img/1729167c-d925-4bc9-890c-9d3096417f09.jpg)

为了使事情更简单，我列出了前几章中介绍的工具列表，这些工具可以帮助您执行漏洞评估和渗透测试，作为 PCI DSS 自我评估的一部分。同样，一些工具可能在整个列表中重复，因为它们可能执行多种功能：

*   信息收集（[第 4 章](04.html)、*足迹和信息收集*：
    1.  德夫斯普洛特
    2.  罢工者
    3.  红鹰

*   扫描（[第 5 章](05.html)、*扫描与绕过技术*：
    1.  Nmap
    2.  红鹰

*   脆弱性评估（[第 6 章](06.html)、*脆弱性扫描*：
    1.  OpenVAS
    2.  内苏斯
    3.  Lynis（Linux 系统审计）。
    4.  斯巴达

*   [第 7 章](07.html)、*社会工程*：
    1.  社会工程工具包

*   剥削（第 8-12 章）：
    1.  变质岩
    2.  网络猎手

*   报告（[第 14 章](14.html)、*渗透测试报告工具*：
    1.  Dradis 框架

当然，还有许多其他工具可用于评估，但这些应该足以让您开始。*  *# 总结

在本章中，我们介绍了**支付卡行业数据安全标准**（**PCI DSS**）及其对必须符合 PCI DSS 的组织的目标和要求。我们还根据每年处理的支付卡交易量，研究了所需的各种合规性级别。我们还了解了细分的重要性及其对 PCI DSS 评估的影响，然后详细介绍了范围界定过程。

在本章末尾，我们了解到，只有合格且经验丰富的专业人员才有权进行 PCI DSS 自我评估，而且必须雇佣 PCI DSS ASV 进行年度外部 PCI DSS 评估。最后，我们回顾了本书前几章中使用的各种工具，这些工具可以专门用于执行评估。

在下一章中，我们将介绍创建报告并帮助我们将渗透测试的各个方面联系起来的工具。

# 问题

1.  哪些公司开发了 PCI DSS 标准？
2.  PCI DSS 的当前版本是什么？
3.  PCI DSS 中有多少目标和要求？
4.  哪些要求涉及内部和外部 PCI DSS 评估？
5.  ASV 可以进行哪种类型的评估/评估？
6.  ASV 必须多久进行一次外部评估？
7.  细分的目的是什么？
8.  当提到评估的范围界定方面时，结构化测试过程指的是什么？
9.  专业渗透测试人员应具备哪些资格？
10.  哪些漏洞评估工具可用于执行 PCI DSS 自我评估？

# 进一步阅读

关于 PCI DSS 标准还有很多需要了解的内容。有关 PCI DSS、评估和与之相关的一般知识的更多信息，请访问以下链接：

*   要求及安全评估程序：[https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf](https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf)
*   PCI DSS 快速参考指南：[https://www.pcisecuritystandards.org/documents/PCI_DSS-QRG-v3_2_1.pdf?agreement=true &时间=1535905197919](https://www.pcisecuritystandards.org/documents/PCI_DSS-QRG-v3_2_1.pdf?agreement=true&time=1535905197919)
*   合规性报告的 PCI DSS 模板：[https://www.pcisecuritystandards.org/documents/PCI-DSS-v3_2_1-ROC-Reporting-Template.pdf?agreement=true &时间=1535905197972](https://www.pcisecuritystandards.org/documents/PCI-DSS-v3_2_1-ROC-Reporting-Template.pdf?agreement=true&time=1535905197972)
*   追求 PCI DSS 合规性的优先方法概述：[https://www.pcisecuritystandards.org/documents/Prioritized-Approach-for-PCI-DSS-v3_2_1.pdf?agreement=true &时间=1535905628536](https://www.pcisecuritystandards.org/documents/Prioritized-Approach-for-PCI-DSS-v3_2_1.pdf?agreement=true&time=1535905628536)*
# 序言

渗透测试是当今世界各地企业所需的关键技术之一。随着网络和计算机犯罪在过去几年的兴起，渗透测试已成为网络安全的核心方面之一，有助于保持企业免受内部和外部威胁的安全。渗透测试之所以必要，是因为它有助于发现网络、系统或应用程序中的潜在缺陷。此外，它有助于从攻击者的角度识别弱点和威胁。利用系统中的各种潜在缺陷，找出其对组织的影响以及资产的风险因素。然而，渗透测试的成功率在很大程度上取决于测试目标的知识。因此，我们通常使用两种不同的方法进行渗透测试：黑盒测试和白盒测试。黑盒测试是指在没有被测目标先验知识的情况下进行的测试。因此，渗透测试仪通过系统地收集有关目标的信息开始测试。鉴于，在白盒渗透测试中，渗透测试人员对测试目标有足够的了解，并从识别目标的已知和未知弱点开始。通常，渗透试验分为七个不同阶段，如下所示：

*   **参与前互动**：该阶段定义了所有参与前活动和范围定义，基本上是测试开始前需要与客户讨论的所有内容。
*   **情报收集**：此阶段主要是通过直接与被测目标建立被动连接来收集被测目标的相关信息，完全不需要与目标建立连接。
*   **威胁建模**：此阶段涉及将检测到的信息与资产进行匹配，以找到威胁级别最高的区域。
*   **漏洞分析**：这包括发现和识别已知和未知漏洞，并对其进行验证。
*   **漏洞利用**：此阶段旨在利用前一阶段发现的漏洞。这通常意味着我们正试图访问目标。
*   **后利用**：在目标上执行的实际任务，包括下载文件、关闭系统、在目标上创建新用户帐户等，都是此阶段的一部分。通常，此阶段描述了利用漏洞后需要执行的操作。
*   **报告**：此阶段包括对文件下的测试结果进行总结，以及可能的建议和建议，以修复目标中当前的弱点。

当只有一个目标在测试中时，刚才提到的七个阶段看起来很容易。然而，当一个包含数百个系统的大型网络要进行测试时，情况完全改变了。因此，在这种情况下，人工工作将被自动化方法所取代。考虑一个场景，测试下系统的数量正好是 100，运行相同的操作系统和服务。手动测试每个系统将耗费大量的时间和精力。然而，在这种情况下，需要渗透测试框架的作用。使用渗透测试框架不仅可以节省时间，还可以提供更大的灵活性，以改变攻击向量并覆盖更大范围的测试目标。渗透测试框架还将有助于自动化大多数攻击向量、扫描过程、识别漏洞，最重要的是，利用这些漏洞，从而节省时间并加快渗透测试。

*掌握 Metasploit*旨在让读者深入了解最流行的渗透测试框架，即 Metasploit。这本书特别关注在利用方面掌握 Metasploit，编写自定义利用，移植利用，测试服务，以及进行复杂的客户端测试。此外，本书还帮助您将定制的攻击向量转换为 Metasploit 模块，涵盖 Ruby、assembly 和攻击脚本，如 Cortana。这本书也将帮助你培养编程技能。

# 这本书涵盖的内容

[第 1 章](01.html "Chapter 1. Approaching a Penetration Test Using Metasploit")*使用 Metasploit 进行渗透测试*介绍了使用 Metasploit 进行渗透测试的绝对基础知识。它有助于建立方法和设置测试环境。此外，它还系统地引导我们完成渗透测试的各个阶段。它进一步讨论了使用 Metasploit 优于传统测试和手动测试的优势。

[第 2 章](02.html "Chapter 2. Reinventing Metasploit")*对 Metasploit*的改造，涵盖了模块构建所需的 Ruby 编程要点的绝对基础。本章进一步介绍了如何挖掘现有的 Metasploit 模块，以及如何编写我们的自定义扫描仪、后期开发和 MeterMeter 模块；最后，总结了 RailGun 中定制模块的开发。

[第 3 章](03.html "Chapter 3. The Exploit Formulation Process")*漏洞形成过程*讨论了如何通过涵盖组装编程的基本要素来构建漏洞。本章还介绍了模糊，并对调试器进行了说明。然后，它通过在调试器下分析应用程序的行为，重点收集利用漏洞的要素。最后，根据收集到的信息在 Metasploit 中展示了漏洞利用的编写过程。

[第 4 章](04.html "Chapter 4. Porting Exploits")*移植漏洞*有助于将公开可用的漏洞转化为 Metasploit 框架。本章重点介绍从可用的 Perl、Python 和 PHP 编写的漏洞中收集要点，并使用 Metasploit 库将这些要点解释为与 Metasploit 兼容的要点。

[第 5 章](05.html "Chapter 5. Offstage Access to Testing Services")*后台访问测试服务*继续讨论如何对各种服务进行渗透测试。本章介绍 Metasploit 中的一些重要模块，这些模块有助于利用 SCADA 服务。此外，还讨论了测试数据库和在其中运行特权命令。其次，它揭示了 VOIP 攻击和实施诸如欺骗 VOIP 呼叫等攻击。最后，本章讨论了 Apple iDevices 的后期开发。

[第 6 章](06.html "Chapter 6. Virtual Test Grounds and Staging")、*虚拟试验场和舞台*简要讨论了如何进行白盒和黑盒试验。本章重点介绍可以与 Metasploit 一起进行完整渗透测试的其他工具。本章通过讨论流行工具（如 Nmap、Nessus 和 OpenVAS）进行了深入讨论，并讨论了将它们的结果导入 Metasploit 并从 Metasploit 本身运行这些工具。最后讨论了如何生成手动和自动报告。

[第 7 章](07.html "Chapter 7. Sophisticated Client-side Attacks")*复杂的客户端攻击*将我们的重点转移到客户端漏洞利用上。本章重点介绍如何将传统的客户端漏洞利用修改为更加复杂和确定的方法。本章首先介绍基于浏览器的漏洞利用和基于文件格式的漏洞利用。此外，它还讨论了损害 web 服务器和网站用户的问题。接下来，它揭示了绕过防病毒和保护机制。然后，讨论了使用 Metasploit 以及 DNS 中毒等载体将浏览器漏洞攻击修改为致命武器的问题。

[第 8 章](08.html "Chapter 8. The Social Engineering Toolkit")*社会工程工具包*使用 Metasploit 作为后端，帮助实现客户端开发的自动化。本章介绍各种网站攻击载体，并帮助实施高级网络钓鱼攻击。然后重点介绍了攻击向量，如 tabnabbing、Java 小程序和许多其他攻击向量。此外，它还揭示了社会工程工具包中的第三方模块。接下来，讨论社会工程工具包的 GUI 部分，以及如何在其中自动化各种攻击。

[第 9 章](09.html "Chapter 9. Speeding Up Penetration Testing")*加快渗透测试*的重点是开发渗透测试的快速方法。本章首先讨论 Fast Track 并使用 Fast Track 测试数据库。此外，还讨论了 Metasploit 丢失的功能以及如何在 Metasploit 中重新启用这些功能。最后，本文讨论了另一个伟大的工具，即 WebSploit，并介绍了如何使用它进行复杂的客户端开发。

[第 10 章](10.html "Chapter 10. Visualizing with Armitage")*用 Armitage*可视化，专门介绍与 Metasploit 相关的最流行的 GUI，即 Armitage。本章以 Armitage 扫描目标和利用目标为基础。此外，还讨论了 Cortana，它用于在 Armitage 中编写自动攻击脚本，并通过开发虚拟机器人帮助进行渗透测试。接下来，本章将讨论在 Armitage 中添加自定义功能以及构建自定义界面和菜单。

# 这本书你需要什么

要遵循并重新创建本书中的示例，您需要两到三个系统。一个可以是您的渗透测试系统，而另一个可以是要测试的系统。或者，您可以在单个系统上工作，并在虚拟环境中设置其他两个系统。

除了系统之外，您还需要最新的 Kali Linux ISO，它附带了预装的 Metasploit，并包含重新创建本书示例所需的所有其他工具。

但是，您需要 Ubuntu、Windows XP、Windows Server 2003、Windows 7 和 Windows Server 2008 的 ISO 来使用 Metasploit 测试它们。值得注意的是，本书中描述了所有其他工具及其确切版本。

# 这本书是给谁的

本书的目标是专业渗透测试人员、安全工程师和分析师，他们拥有 Metasploit 的基本知识，希望掌握 Metasploit 框架，并希望开发利用写作技能和模块开发技能；它还针对那些希望获得测试各种服务的测试技能的人。此外，它还帮助所有希望将自定义功能添加到 Metasploit 的研究人员。最终，从中级兼初级到专家级的过渡是顺利的。本书讨论了 Ruby 编程、汇编语言和使用 Cortana 编写攻击脚本。因此，需要对编程语言有一点了解。

# 公约

在这本书中，你会发现许多不同类型的文本可以区分不同类型的信息。下面是这些风格的一些例子，并解释了它们的含义。

文本中的代码字、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 句柄如下所示：“这可以通过使用`db_export`函数简单地实现。”

代码块设置如下：

```
require 'msf/core'
require 'rex'
require 'msf/core/post/windows/registry'
class Metasploit3 < Msf::Post
  include Msf::Post::Windows::Registry
  def initialize
    super(
        'Name'          => 'Drive Disabler Module',
        'Description'   => 'C Drive Disabler Module',
        'License'       => MSF_LICENSE,
        'Author' => 'Nipun Jaswal'
      )
  End
```

任何命令行输入或输出的编写方式如下：

```
#services postgresql start
#services metasploit start

```

**新术语**和**重要词语**以粗体显示。例如，您在屏幕上的菜单或对话框中看到的文字出现在文本中，如下所示：“在**名称**字段中键入适当的名称，然后选择**操作系统**类型和**版本**。”

### 注

警告或重要注释显示在这样的框中。

### 提示

提示和技巧如下所示。

# 读者反馈

我们欢迎读者的反馈。让我们知道你对这本书的看法你喜欢或可能不喜欢什么。读者反馈对于我们开发您真正从中获益最多的标题非常重要。

要向我们发送一般反馈，只需向`<[feedback@packtpub.com](mailto:feedback@packtpub.com)>`发送电子邮件，并通过邮件主题提及书名即可。

如果您对某个主题有专业知识，并且您有兴趣撰写或贡献一本书，请参阅我们的作者指南，网址为[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

既然您是一本 Packt 图书的骄傲拥有者，我们有很多东西可以帮助您从购买中获得最大收益。

## 勘误表

虽然我们已尽一切努力确保内容的准确性，但错误确实会发生。如果您在我们的一本书中发现错误，可能是文本或代码中的错误，如果您能向我们报告，我们将不胜感激。通过这样做，您可以使其他读者免于沮丧，并帮助我们改进本书的后续版本。如果您发现任何错误，请访问[进行报告 http://www.packtpub.com/submit-errata](http://www.packtpub.com/submit-errata) ，选择您的书籍，点击**勘误表****提交****表单**链接，输入您勘误表的详细信息。一旦您的勘误表得到验证，您的提交将被接受，勘误表将上传到我们的网站上，或添加到该标题勘误表部分的任何现有勘误表列表中。通过从[中选择您的标题，可以查看任何现有勘误表 http://www.packtpub.com/support](http://www.packtpub.com/support) 。

## 盗版

在互联网上盗版版权材料是所有媒体的一个持续问题。在 Packt，我们非常重视版权和许可证的保护。如果您在互联网上发现我们作品的任何形式的非法复制品，请立即向我们提供地址或网站名称，以便我们采取补救措施。

请致电`<[copyright@packtpub.com](mailto:copyright@packtpub.com)>`与我们联系，并提供可疑盗版材料的链接。

我们感谢您在保护我们的作者方面的帮助，以及我们为您带来有价值内容的能力。

## 问题

如果您对本书的任何方面有疑问，请致电`<[questions@packtpub.com](mailto:questions@packtpub.com)>`与我们联系，我们将尽力解决。
# 附录 A.笔试 101 基础

在本章中，我们将介绍以下主题：

*   介绍
*   什么是渗透测试
*   什么是脆弱性评估
*   渗透测试与脆弱性评估
*   渗透测试的目标
*   Types of penetration testing:

    *   黑匣子
    *   白盒
    *   灰盒

*   谁应该做渗透测试
*   这里的目标是什么
*   一般渗透测试阶段
*   收集要求
*   准备测试计划
*   渗透测试的不同阶段
*   提供测试客观性和边界
*   项目管理和第三方批准
*   脆弱性的分类
*   威胁管理
*   资产风险评级
*   汇报
*   结论

# 导言

保护任何组织的 IT 基础架构和客户数据都至关重要；信息安全计划确保任何系统的可靠、不间断和安全运行。信息安全是一个广泛的领域，根据效率和专业知识可分为几个类别，如 web 应用程序安全、移动应用程序安全和网络安全。

每个类别都有自己的背景要求，例如，开发人员可以成为优秀的 web 应用程序测试人员，移动应用程序开发人员可以更好地掌握移动应用程序安全，网络和系统管理员可以成为网络/系统/DevOps 安全工程师。不需要事先了解，但需要了解他们正在执行安全评估的领域的详细知识。

在本章中，我们将学习渗透测试方法。在开始渗透测试之前，我们将列出您应注意的所有事项。你应该对一些问题有明确的答案，比如什么是渗透测试？它与脆弱性评估有何不同？作为一个组织，我们为什么要进行渗透测试？谁应该对内部团队或专门从事安全评估的外部供应商进行渗透测试？

# 什么是渗透测试？

渗透测试是一种从内部或外部对系统进行的面向安全的战略探测，事先对系统本身知之甚少或一无所知，以找出攻击者可以利用的漏洞。当我们谈论渗透测试时，它并不局限于一台独立的机器；它可以是 web 或网络应用程序、主机或网络的任意组合，也可以是云端或内部的组合。换句话说，渗透测试是评估 IT 基础设施所有组件的活动，包括但不限于操作系统、网络通信协议、应用程序、网络设备、物联网连接设备、物理安全和人类心理，使用与攻击者完全相同的目标方法和方法，但由授权且经验丰富的安全专业人员在公司董事会或经理批准的范围内执行。

维基百科给出的定义是：“渗透测试，非正式的笔试，是对计算机系统的一种攻击，它寻找安全弱点，有可能访问计算机的功能和数据。”。在模拟内侵彻或外侵彻以及改变提供的目标信息量方面，pen 测试存在各种变化。它们每一个都有自己的好处，但实际上这取决于什么让你获得最大的保证，以及当下的需要。

# 什么是脆弱性评估

漏洞评估是将网络服务和版本映射到公共可用漏洞的活动。它是非侵入性的，但基于主动收集的信息，并与基于不同版本的可用漏洞利用范围相关联。

漏洞评估可以在云上或房屋内的任何位置的 web 应用程序、网络协议、网络应用程序、网络设备和服务器上执行。有时，脆弱性评估是必要的，因为雇主、组织或客户可能没有做好渗透测试的准备，因为他们担心由于渗透测试而破坏系统或丢失数据，或两者兼而有之。

值得注意的是，脆弱性评估不是实际的利用，而是与来自公共来源的相关数据相匹配，其中提到了网络/系统上给定版本服务的利用可用性。它包含误报。

# 渗透测试与脆弱性评估

渗透测试和脆弱性评估之间的一个主要区别在于开发部分。您不会在漏洞评估中执行攻击，但攻击是渗透测试的主要焦点和实际结果。

以下是一些其他值得注意的区别：

<colgroup><col> <col> <col></colgroup> 
| **微分器** | **脆弱性评估** | **渗透测试** |
| 自动化 | 可以完全自动化，达到令人满意和可靠的结果水平。 | 可以在一定程度上实现自动化，但需要熟练的个人查找所有可能的漏洞，并实际使用这些信息从不同的条目中利用和渗透系统。 |
| 时间 | 由于它可以自动化，显然需要较少的时间，并且取决于检查的数量和正在检查的系统的数量。但大多数情况下，它可以在一台机器上在几分钟内完成。 | 由于它是手动的，因此需要人类的效率和创造力来进行开箱思考，并利用漏洞来获得访问权限。完全访问一个安全性足够的系统可能需要几天的时间。 |
| 噪声级 | 被动和创建更少的日志 | 吵闹和好斗；创建大量日志，可能会非常混乱 |
| 假阳性 | 报告假阳性 | 消除误报 |
| 方法 | 程序化 | 直觉的 |
| 测试的性质 | 相同的测试/扫描 | 准确/彻底 |
| 剥削 | 不适用 | 完全访问系统 |

# 渗透测试的目标

渗透测试的目标非常简单明了；渗透测试让执行官、架构师和产品经理 360 度鸟瞰组织的安全态势。渗透测试还有助于决策者了解实际攻击的情况，以及它对业务、收入和商誉的影响。该过程涉及对任何潜在漏洞的安全、技术和操作对策进行严格分析，这些漏洞的范围从不良到不正确的网络配置，到硬件、固件或软件缺陷。通过缩小安全风险并了解当前安全措施的有效性，它也有助于关注重要内容。还有其他主要原因：

*   **作为起点：**要解决问题，首先需要识别它。这正是渗透测试所做的；它有助于确定问题及其所在。它有助于您了解哪里可能出现漏洞，以及可能出现漏洞的确切原因是什么，以便组织能够制定行动计划，在将来缓解这些安全问题。
*   **风险优先级**：识别安全问题是渗透测试的主要目标。在了解到存在安全问题后，它还有助于根据其影响和严重性对提出的安全问题进行优先级排序。
*   **提高组织的整体安全性**：渗透测试不仅有助于识别技术安全问题，也有助于识别非技术问题，如多久可以识别出攻击，如果识别出，可以采取什么行动，如何升级，向谁升级，以及在发生违约时应采取的措施。它给出了实际攻击的样子。它还有助于确定漏洞是技术漏洞还是非技术漏洞，例如用户点击网络钓鱼电子邮件，直接访问笔记本电脑，破坏防火墙中的所有网络安全设备和规则。这表明缺乏员工安全信息培训。

# 渗透测试的类型

为了成功地进行笔测试活动，需要将流程映射到整个流程。

还有不同类型的方法：

*   黑箱法
*   白盒法
*   灰箱法

以下章节是测试阶段最常见的规范/方法。

## 黑匣子

在黑盒方法中，测试人员不了解底层基础结构，而是执行测试。这就像是在黑暗中开枪，通常是现实生活中的攻击；唯一的缺点是执行测试的时间限制，因为攻击者有很多时间来计划和准备攻击；然而，测试人员不会，这将影响财务状况。黑盒方法通常如下所示：

*   网络、应用程序、服务器等的枚举
*   强制认证区域
*   扫描网络以发现漏洞
*   在测试环境中测试漏洞利用
*   调整漏洞
*   执行漏洞利用
*   深入挖掘，深入内部网络
*   清理

## 白盒

这种方法是一种非常广泛的方法，并且进行了广泛的测试，主要是因为在白盒中显示了所有凭据、源代码、网络体系结构、操作系统配置、数据库配置和防火墙规则。这种审计需要花费大量时间，但也提供了公司易受攻击的准确信息，原因是整个工作范围都很容易获得，不涉及猜测工作；一切都不可避免地摆在你面前。这些步骤包括：

*   查看源代码
*   查看网络设备、操作系统和数据库的配置文件
*   使用域和服务器凭据扫描网络
*   找出漏洞
*   测试漏洞
*   执行漏洞攻击
*   清理

## 灰盒

这是前面讨论过的方法中的一种方法。有一些可用的部分详细信息可以帮助我们执行审计——这些信息包括网络范围、应用程序、服务器的凭据等。此外，在灰盒活动中，防火墙规则被设置为允许通信量知道执行渗透测试的原因。这些步骤包括：

*   使用提供的详细信息访问设备、应用程序和服务器
*   扫描和评估系统和应用程序
*   找出漏洞
*   利用漏洞
*   深挖
*   执行漏洞攻击
*   清理

# 谁应该做渗透测试？

这是一个具有挑战性的问题；这里需要认识到的一件重要事情是，任何人只要有安全知识，随时了解日常漏洞，过去曾执行过 pen 测试活动，精通漏洞，而且是有经验且具有良好认证的人，都是此类活动的首选。

考虑到这一点，可以做两件事：一是成立一个内部安全部门，定期执行渗透活动，同时监控任何主动威胁，并实时识别和缓解这些威胁；二是聘请外部人员执行渗透测试活动，每年或每季度一次。通常，最佳且经济高效的方法是拥有一个内部测试团队，该团队具备渗透测试的知识，并且能够在 CERT、利用 DB、NVD 等的帮助下执行实时评估。有一个安全团队总比什么都没有好；正如人们所说，有点预防总比没有预防好。

当我们谈论外包时，我们需要了解，根据季度实践，这项活动将每年进行一次或四次，通常这是一项非常昂贵的活动。需要仔细评估情景，并决定外部实体是否有效或内部团队是否有效；两者各有利弊。其中一个标准包括对前来组织测试的人员发现的缺陷的可信度和保密性；一个人永远不知道另一个人的动机。此外，在确保信息不会在外包活动时泄露方面，还需要花很多心思。当这项活动每年进行一次时，人们也无法清楚地了解其潜在的基础设施；它只是给出了组织在那个时间点上的样子。

对于网络和设备的安全性存在一些误解，每个人都需要弄清楚：

*   没有什么是 100%安全的
*   部署防火墙不会使网络 100%安全，不受入侵企图的影响
*   IDS/IPS 不能提供 100%的安全保护，以防攻击者攻击
*   AV 并不总是有助于保护您的系统免受 0 天攻击
*   不上网也不能完全保护你免受攻击
*   执行年度测试也不会为下一年提供安全保障

# 这里的目标是什么？

目标是确保识别网络中的系统及其漏洞，并减轻这些漏洞，以便未来不会对这些已知漏洞进行攻击，同时确保识别网络中的每个设备及其开放端口和漏洞。

# 一般渗透测试阶段

成功的渗透尝试分阶段进行，以便理解或复制理解渗透测试核心能力阶段的相同需求。

该过程可细分如下：

1.  收集要求
2.  准备和规划（阶段、目标、批准）
3.  评估/检测设备及其漏洞
4.  实战
5.  脆弱性的分类/报告
6.  威胁管理/资产风险评级
7.  报告

让我们简单地了解一下这些过程。

## 采集要求

在这个阶段，我们收集尽可能多的关于目标的信息，比如识别 IP 地址和端口详细信息。完成此操作后，可以收集有关其正在运行的操作系统类型以及端口上运行的服务及其版本的更多信息。此外，还可以对防火墙规则或对体系结构施加的网络限制进行映射。

作为攻击者，我们会执行以下操作：

*   确保检测到的所有 IP 地址都根据操作系统和设备类型进行标识
*   识别打开的端口
*   识别在这些端口上运行的服务
*   如果可能，这些服务的版本详细信息
*   电子邮件 ID 公开、邮件网关公开等
*   映射范围的整个 LAN/WAN 网络

## 准备和计划

整个活动的一个非常关键的阶段是规划和准备；与此微小的偏差可能是灾难性的。为了理解这一点，需要了解渗透测试是一项消耗基础设施大量带宽的活动。任何组织都不想让他们的网络在核心业务时间或业务高峰时期停滞。其他因素可能包括导致网络拥塞和崩溃的过多流量。在开始活动之前，还有许多其他关键因素需要解决。应与利益相关者召开启动会议，并应确定测试的明确边界，以确定在何处以及在何处进行测试。一旦结束，就可以确定执行活动的有效时间，以确保网络不受影响，业务不受影响。一个人也应该考虑执行这项活动所花的时间；有必要定义一个时间表，因为这会影响财务和测试人员的可用性。还应记录将要测试和审核的设备入围名单。

应在会议上讨论何时对各种入围设备进行渗透测试。将关键服务器映射到非关键服务器，并确定其执行测试的及时性，以使业务不受影响，这也必须得到双方的一致同意。组织应打电话告知其团队是否要进行渗透测试；这样做将确保业务不会受到影响，但是，检测事件的主动性将超出范围。不通知团队正在进行的渗透测试可能有其自身的好处和陷阱；其中之一是，如果网络团队检测到攻击，它将按照程序对网络进行全面锁定，这可能会导致业务损失，并减慢业务功能，导致局部混乱。

如果组织计划将渗透活动外包，则应签署协议，规定在测试范围内获得的所有信息和机密文件不得超出网络，第三方将遵守保密协议，所有检索到的信息和发现的漏洞都将保存在组织内部。

## 界定范围

一旦完成活动的全部准备和计划，渗透测试人员就可以开始书中所述的全部活动。本书涵盖了整个过程的各个部分，包括信息收集、漏洞评估、渗透测试、深度挖掘等。一旦发现漏洞，应启动渗透测试计划。

## 进行渗透测试

在这里，渗透测试人员必须决定要测试哪些系统，比如说，为了一般化，有 n 个系统，m 个系统是台式机。然后，测试应该集中在 n-m 系统上，例如服务器。在这里，测试人员可以了解它们是什么类型的设备，然后就可以开始利用它们了。利用漏洞应为定时活动，因为应用程序或设备崩溃的可能性可能会增加，如果利用漏洞失败，业务可能会受到影响。一旦确定漏洞数量，应制定时间表，说明应允许多少时间来执行整个测试活动。

正如我们在本章中所看到的，可以使用各种工具。Kali 提供了成功执行活动所需的所有工具的广泛资源。还可以向组织澄清社会工程是否是渗透测试的一个令人满意的方面；如果是，这些方法也可以包括在这里并付诸实施。

## 漏洞分类

所有成功和失败的攻击都应该在这里进行映射，并且应该按照关键、高、中、低评级进行分类。这一结论可以在受影响设备的关键性和 CVSS 等级或漏洞风险等级的帮助下得出。计算风险时考虑了许多因素：*风险=可能性*影响*。

## 资产风险评级

以下各项考虑了各种因素：

*   估计可能性的因素
*   估计风险的因素

以下是 OWASP 的图表，有助于了解估计可能性的因素：

![Asset risk rating](graphics/Capture01.jpg)

为了了解脆弱性影响的估计，我们参考以下图表：

![Asset risk rating](graphics/Capture02.jpg)

## 报告

这是管理层要查看的关键部分，报告中显示了网络渗透测试的全部艰苦工作。报告必须非常仔细，应给出所执行活动的所有细节，报告应涵盖并被所有级别理解：开发级别、管理级别和更高的管理级别。

报告应涵盖所做的分析，需要根据风险评级显示漏洞。根据风险评级报告漏洞始终是一种最佳做法，关键级别在顶部，最低级别在底部。这有助于管理层更好地了解漏洞，并根据漏洞的风险评级采取行动。

报告的内容应包括以下内容：

*   涵盖报告全部要点的索引
*   需要注意的顶级漏洞列表
*   所有调查结果的摘要
*   范围，由组织定义
*   审核阶段发现的任何限制或障碍
*   所有漏洞的详细列表
*   漏洞描述及其证据
*   修复漏洞的建议
*   修复漏洞的替代方案
*   术语汇编

# 结论

这项活动可以圆满结束。然而，我们必须知道，这不是一个万无一失的机制。这是因为 pen 测试人员执行活动的时间有限，而攻击者没有时间表，随着时间的推移，他们可以通过收集多个漏洞来制定方法来模拟攻击。
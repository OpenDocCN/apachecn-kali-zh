# 第一章基础知识

如今，安全性对于任何组织来说都是最重要的主题，无论其规模大小或业务类型如何。这样做的主要原因是组织不想因为影响安全的妥协而失去声誉或业务；其次，它们必须满足法律和监管要求。在基础设施的技术安全方面，脆弱性评估和渗透测试（PT 或 PenTest）发挥着最重要的作用。本章说明什么是 PT 或 PenTest，为什么需要它，以及如何为您的组织设置和管理 Nessus。

本章将向您介绍 Nessus，一种用于漏洞评估和渗透测试的工具。我们还将讨论以下主题：

*   脆弱性评估
*   渗透测试
*   奈索斯简介
*   在不同平台上安装 Nessus
*   更新 Nessus 插件
*   Nessus 用户管理
*   Nessus 系统配置

# 脆弱性评估和渗透测试

**漏洞评估****VA**和**渗透测试****PT**或**PenTest**是最常见的技术安全风险评估或使用不同工具进行的技术审计。如果这些工具得到最佳使用，将产生最佳结果。不正确的配置可能导致多个误报，这些误报可能反映也可能不反映真实的漏洞。从小型组织到大型企业，所有人都广泛使用漏洞评估工具来评估其安全状态。这有助于他们及时做出决策，保护自己免受这些漏洞的影响。本书概述了使用 Nessus 进行脆弱性评估和 PenTests 的步骤。Nessus 是广泛认可的用于此类目的的工具。本节向您介绍有关这两种评估的基本术语。

IT 系统的脆弱性可以定义为系统/基础设施中的潜在弱点，如果被利用，可能导致对系统的攻击。

漏洞的一个示例是系统中的弱字典单词密码，该密码可被试图猜测密码的暴力攻击（字典攻击）利用。这可能会导致密码被泄露，未经授权的人可以访问系统。

### 注

本书中的**系统**一词是指存在于信息技术或非信息技术环境中的任何资产。

脆弱性评估是一种分阶段确定基础设施中存在的脆弱性的方法。这可以通过使用自动化扫描工具（如 Nessus）来实现，Nessus 使用一组插件来对应基础设施中不同类型的已知安全漏洞，或者使用基于手动检查表的方法，使用最佳实践和知名漏洞跟踪站点上发布的漏洞。手动方法不如基于工具的方法全面，而且会更加耗时。由漏洞评估工具执行的此类检查也可以手动完成，但这将比自动化工具花费更多的时间。

渗透测试还有一个漏洞评估步骤，即利用漏洞。渗透测试是一种侵入性测试，进行渗透测试的人员将首先进行漏洞评估，以识别漏洞，并作为下一步，尝试利用已识别的漏洞渗透系统。

## 需要进行脆弱性评估

了解为什么需要进行漏洞评估或渗透测试对您来说非常重要。尽管进行脆弱性评估或 PenTest 有多种直接或间接的好处，但这里已经记录了其中一些，以供您理解。

### 风险防范

漏洞评估揭示系统中的漏洞/缺口/漏洞。通过定期运行这些扫描，组织可以及时识别 IT 基础架构中的已知漏洞。漏洞评估降低了不符合不同合规性和监管要求的可能性，因为您已经知道自己的漏洞。及时意识到这些漏洞有助于组织修复它们，并在它们被利用之前提前降低所涉及的风险。利用漏洞的风险包括：

*   漏洞利用造成的财务损失
*   组织声誉
*   数据盗窃
*   保密妥协
*   诚信妥协
*   可用性折衷

### 合规性要求

众所周知的信息安全标准（例如，ISO 27001、PCI DSS 和 PA DSS）具有控制要求，要求必须执行漏洞评估。

一些国家对银行和电信等特定行业部门进行脆弱性评估有具体的监管要求。

## 脆弱性评估和渗透测试的生命周期

本节描述了 VA 和 PenTest 生命周期中的关键阶段。这些生命周期几乎相同；渗透测试包括利用已识别漏洞的附加步骤。

建议您根据组织的测试需求和业务目标进行测试，无论是漏洞评估还是渗透测试。此生命周期涉及以下阶段：

1.  范围界定
2.  信息收集
3.  漏洞扫描
4.  假阳性分析
5.  漏洞利用（渗透测试）
6.  报告生成

以下图说明了漏洞评估或渗透测试建议遵循的不同顺序阶段：

![The life cycles of Vulnerability Assessment and Penetration Testing](graphics/7440_01_01.jpg)

### 第 1 阶段-范围界定

范围界定是任何安全评估活动的主要步骤。为了执行 VA 或 PenTest，第一步是根据要进行评估的基础设施确定评估的范围，例如服务器、网络设备、安全设备、数据库、和应用程序。范围取决于脆弱性评估的业务目标。在范围界定期间，还应商定一个扫描窗口。此外，应商定允许的攻击类型。在确定评估范围后，该阶段还包括测试的计划和准备，包括确定测试的团队、日期和时间。在开始审计业务之前，应注意的另一个主要因素是，安全测试人员与将在其基础设施上执行这些测试的一方之间签署正式审计业务协议。范围界定还应包括确定要测试的基础设施元素的数量。

除了基础设施范围和其他项目管理模式外，还应确定具体范围、组织实现业务目标的方法以及评估方法。为了确定业务目标，组织应确定希望模仿的攻击类型。

公司可能寻求的一个目标示例是：“找出外部攻击者可以通过仅在知道公开 IP 地址的情况下以外部暴露的基础设施为目标来实现什么。”这类要求将通过对基础设施和应用程序的外部黑盒渗透测试来满足，方法和方法应该与此相一致。

基于 Internet 或 intranet 对基础设施的可访问性，可以从外部或内部网络进行测试。此外，根据详细信息的类型，基础设施测试可以是 Blackbox 或 Greybox。根据基础设施的类型，应启用漏洞扫描工具的插件或功能，并辅以适当的手动检查。

### 注

在黑盒测试中，测试人员只共享 IP 地址等详细信息。有关 Nessus Scanner 的详细信息（如类型和操作系统版本）未共享；此类测试将涉及非凭证扫描（在[第 2 章](2.html "Chapter 2. Scanning")、*扫描*中解释）。这允许测试人员在对基础结构了解有限的情况下模拟外部攻击者。

Greybox 测试将包括要共享的基础设施的一些细节，例如允许获取更全面的设备和软件版本的类型，以及提供给工具以获得更全面结果的管理员凭据。此外，为了模仿内部攻击者了解 Nessus 扫描仪的基础设施，此类测试将涉及认证扫描，从而提供更全面的结果。

### 第 2 阶段-信息收集

信息收集是 VA-PT 评估的第二个也是最重要的阶段。此阶段包括使用技术（WhoIS）和非技术被动方法（如搜索引擎和互联网组）查找有关目标系统的信息。这一步骤至关重要，因为它有助于更好地了解目标基础架构及其资源。由于评估时间表通常是有时间限制的，因此在该阶段捕获的信息有助于通过使用适用于目标系统的正确工具和方法，在正确的方向上简化测试工作。这一步对于黑盒评估变得更加重要，因为在黑盒评估中，共享的目标系统信息非常有限。

信息收集之后是一种更技术性的方法，使用 pings 和 Telnet 等实用程序以及 NMAP 等端口扫描程序来映射目标网络。使用这些工具将使评估人员能够找到实时主机、开放服务、操作系统和其他信息。

通过网络映射收集的信息将进一步验证通过其他被动方式收集的有关目标基础设施的信息，这对于配置漏洞扫描工具非常重要。这可以确保扫描更恰当地完成。

### 第 3 阶段-漏洞扫描

此阶段涉及对目标基础设施的实际扫描，以识别系统存在的漏洞。这是使用 Nessus 等漏洞扫描程序完成的。扫描之前，应根据初始阶段捕获的目标基础设施信息对工具进行优化配置。还应注意，通过允许通过防火墙等相关中间系统进行访问，该工具能够到达目标基础设施。此类扫描仪执行协议 TCP、UDP 和 ICMP 扫描，以查找目标计算机上运行的开放端口和服务，并将其与工具签名数据库中定期更新的已知已发布漏洞（如果目标基础设施中存在）相匹配。此阶段的输出提供了目标基础架构中存在哪些漏洞的总体视图，如果被利用，可能会导致系统受损。

### 第 4 阶段-假阳性分析

作为扫描阶段的输出，将获得目标基础设施的漏洞列表。使用输出执行的关键活动之一是假阳性分析，即消除工具错误报告且实际不存在的任何漏洞。所有扫描工具都容易报告误报，这种分析可以使用一些方法来完成，例如将漏洞相互关联，以及以前收集的信息和扫描报告，同时实际检查系统访问是否可用。

漏洞扫描器为已识别的漏洞提供自己的风险评级；考虑到基础设施元素（服务器或网络设备）对网络的实际重要性以及漏洞的影响，可以重新审视这些漏洞。

### 第 5 阶段-漏洞利用（渗透测试）

如果系统所有者要求证明存在漏洞或利用漏洞，以了解攻击者可以在多大程度上危害易受攻击的系统，测试人员将被要求在受控环境中演示利用漏洞的行为，而不实际使基础设施不可用，除非这是一项要求。渗透测试是漏洞评估的下一步，旨在基于已识别漏洞的可用漏洞穿透目标系统。对于漏洞利用，可以利用我们自己的知识或公开的已知漏洞利用。渗透测试或漏洞利用可大致分为开发前、开发和开发后三个阶段。

开发前阶段的活动在第 1 至第 4 阶段进行了说明，即列举基础设施并识别漏洞。

一旦利用任何漏洞获得对系统的访问权限，攻击者应通过嗅探流量、映射内部网络并尝试获取更高权限的帐户来获得对系统的最大访问权限，从而进一步细化网络。这将使测试人员能够对网络发起进一步的攻击，以进一步扩大受损系统的范围。攻击后步骤还包括通过执行诸如清除日志和禁用防病毒等活动来清除跟踪。

作为攻击后阶段测试人员，您可以演示攻击者如何通过后门和 rootkit 维护对系统的访问。

### 第 6 阶段-报告生成

根据工作范围完成评估后，需要完成以下关键领域的最终报告：

*   评估简介
*   评估范围
*   管理/执行摘要
*   风险严重性调查结果概要
*   关于每个发现及其影响的详细信息，以及修复漏洞的建议

# 奈索斯简介

Nessus 是应用最广泛的脆弱性评估产品之一。该工具于 1998 年由*Renaud Deraison*首次发布，是过去 15 年来业界最流行的漏洞扫描工具之一。

Nessus 的官方网站（[http://www.tenable.com](http://www.tenable.com) 描述如下：

> *“Nessus®是业界部署最广泛的漏洞和配置评估产品。Nessus 具有高速发现、配置审核、资产分析、敏感数据发现、补丁管理集成和安全态势漏洞分析等功能。Nessus ProfessionalFeed®是一个不断更新的库，包含 50000 多个漏洞和配置检查，由专家漏洞研究团队提供支持，Nessus 为市场提供准确度。Nessus 可扩展以服务于最大的组织，且部署速度快且容易。”*

多年来，Nessus 已经从一个纯粹的漏洞扫描器发展到包括附加的评估和审计功能，如配置审计、合规审计、补丁审计、控制系统审计和移动设备审计。它以其脆弱性评估功能提供的方便性和灵活性而闻名。

Nessus 漏洞扫描程序涵盖的关键基础设施包括以下内容：

*   **网络设备**：包括 Juniper、Cisco、防火墙和打印机
*   **虚拟主机**：包括 VMware ESX、ESXi、vSphere 和 vCenter
*   **操作系统**：包括 Windows、Mac、Linux、Solaris、BSD、Cisco iOS 和 IBM iSeries
*   **数据库**：包括 Oracle、MS SQL Server、MySQL、DB2、Informix/DRDA 和 PostgreSQL
*   **Web 应用程序**：包括 Web 服务器、Web 服务和 OWASP 漏洞

Nessus 漏洞扫描器是一款易于使用的工具。熟悉该工具的人可以轻松地学习它。

## 初始 Nessus 设置

本章后面将给出安装 Nessus 的详细步骤。安装 Nessus 后，您可以对 Nessus 扫描仪进行一次性设置，例如设置用户帐户以访问扫描仪；常规设置，例如配置 SMTP 或 web 代理、源设置、移动设置和结果设置；以及配置高级配置设置。本章后面将详细介绍这些设置。它们对于您的扫描环境非常独特，这取决于您组织的安全策略和首选项。根据需要，在进行扫描之前，您可能还需要创建一些通用策略。

## 安排扫描

Nessus 提供了在目标主机上安排扫描以备将来扫描的灵活性。这和作业调度一样好。您可以使用预定义的时间和策略提前配置和计划。Nessus 将在定义的时间自动启动扫描，并将结果通过电子邮件发送到预定义的电子邮件 ID。这不需要任何手动触发器来调用扫描。您还可以安排重复扫描，例如“我的扫描目标 IP 应在每周四 CET 凌晨 3 点进行扫描”。大多数情况下，大型企业组织在识别扫描窗口方面面临许多挑战。扫描窗口是扫描的时间范围，它定义了扫描应在何时进行以及何时完成。通常，扫描窗口根据扫描机上的生产负荷确定。建议仅在非高峰时间扫描生产机器。非高峰时间是指目标或扫描机在一天/一周内最少使用的时间。

## Nessus 插件

为了全面覆盖安全检查，Nessus 提供了大量插件组合在一起，以提供类似的安全检查。分组允许基于目标机器一次性禁用或启用大量插件。主要插件系列的示例包括 Windows、Linux、Solaris、Cisco 和数据库。有关插件的详细信息以及家庭订阅源和专业订阅源系列之间的差异，请参阅 Nessus 官方网站[https://plugins.nessus.org](https://plugins.nessus.org) 。

Nessus 是使用最广泛的工具之一，在[有一个活跃的在线支持社区 https://discussions.nessus.org](https://discussions.nessus.org) 。

Nessus 是最具成本效益的扫描工具之一，具有低总体拥有成本（TCO）和扫描无限数量的 IP 等功能。Nessus 订阅包括软件更新、访问 Tenable 的合规性和审核文件以及支持。此外，它还包括通过自动安装每日更新漏洞和配置检查。

### 注

除了介绍 Nessus 外，本章还介绍了漏洞评估和渗透测试的基础知识，这是使用 Nessus 进行的两种最常见的技术风险评估。此外，还介绍了 Nessus 中的各种安装选项。

## 使用 Nessus 进行补丁管理

Nessus 在补丁管理方面非常成功；这是通过将 Nessus 与各种补丁管理解决方案集成而实现的。这里的好处是，您不需要向 Nessus 提供用于扫描目标机器的凭据；相反，您需要为修补程序管理系统提供凭据。这是因为修补程序管理系统已经具有到达目标主机的凭据。

## 使用 Nessus 进行治理、风险和合规性检查

Nessus 提供不同格式的输出，如 HTML、CSV 和 PDF。这使得将输出提供给不同的工具进行集成变得更加灵活。这些工具可以是治理、风险和法规遵从性工具，如 EMC RSA Archer SmartSuit 或任何其他类似工具。

# 在不同平台上安装 Nessus

Nessus 支持几乎所有流行的操作系统。根据操作系统的可用性，可以按照本节中给出的所需安装步骤安装 Nessus。最新信息/步骤也可从 Nessus 的官方网站获取。在撰写本书时，Nessus 支持以下操作系统平台：

*   Microsoft Windows–XP、2003、2008、Vista、2012、7 和 8
*   Linux–Debian、Red Hat、Fedora、SuSE、Ubuntu
*   Solaris
*   雨衣
*   免费 BSD
*   校验和和和 GCP 密钥

上述名单的最新详情可从 Tenable Nessus 的官方网站[获取 http://www.tenable.com/](http://www.tenable.com/) 。

## 先决条件

扫描机应具有 4GB 内存（最好）。但是，请参考 Nessus 的官方网站[http://www.tenable.com/](http://www.tenable.com/ ) 了解最新要求。

更好的处理器将支持快速扫描。选择扫描机时，应注意 Nessus 扫描范围；如果计划对大型企业进行漏洞评估，建议使用高端服务器。

### 注

任何防火墙都不应阻止 Nessus 生成的流量到达扫描目标系统。如果有防火墙，则应配置防火墙规则，以允许 Nessus 计算机生成的所有流量到达扫描目标。扫描活动完成后，请不要忘记停用此防火墙规则。

如果您使用 web 代理接触扫描机器，代理身份验证凭证应该输入 Nessus。这是一个可选设置，具体取决于您的扫描环境。

您应该拥有安装 Nessus 的计算机管理权限，更新插件需要 Nessus 插件提要激活代码。

## 在 Windows 7 上安装 Nessus

对于最新的 Nessus 套餐，无论是购买还是评估，您都应该浏览 Tenable Nessus 的官方网站[http://www.tenable.com/](http://www.tenable.com/) ：

1.  Log in to the Nessus website to buy and download the latest Nessus software from the **Products** section.

    应根据要安装 Nessus 的操作系统下载 Nessus 软件包。下载 Nessus 软件包时应遵循 Nessus 网站上给出的步骤。

    需要注意的是，Nessus 应该按照您计划扫描其他系统的扫描机操作系统下载，而不是按照您要扫描的操作系统下载。例如，如果需要从 Windows 2008 服务器计算机扫描 10 台 Linux 计算机、一台 Solaris 计算机和五台 Windows 计算机，请下载适用于 Windows 2008 操作系统的 Nessus 软件包。根据操作系统的位计数，您可以选择 32 位/64 位软件包。

2.  下载 Nessus 可执行文件（Nessus 安装程序包）后，双击该文件开始安装。如果您没有管理权限，请按*Shift*并右键单击可执行文件；单击**以**的身份运行，以管理帐户运行安装程序。
3.  您可能会收到安全警告**是否要运行此文件？**。点击**运行**按钮。
4.  点击**运行**后，安装程序会弹出窗口继续安装。
5.  Click on **Next**, and this will pop up the window with the Nessus license agreement. It is very important for everyone to read through the license agreement and abide by the same.

    ![Installing Nessus on Windows 7](graphics/7440_01_04.jpg)

6.  要继续安装 Nessus，您需要接受许可协议并单击**下一步**。
7.  You have an option to change the directory where you want to install Nessus. Click on **Next** to proceed further.

    ![Installing Nessus on Windows 7](graphics/7440_01_06.jpg)

8.  点击**安装**继续。
9.  在安装过程中，您可能会收到另一个提示，提示您**是否要安装此设备软件？**。如果您需要信任 Tenable network security Inc.的所有软件，请选中复选框**始终信任 Tenable network security Inc.**。此选项不是必须选择的。单击弹出的安全窗口上的**安装**继续。
10.  The following screenshot indicates successful installation. Click on **Finish** to proceed further:

    ![Installing Nessus on Windows 7](graphics/7440_01_10.jpg)

在 Nessus 安装成功后，您将进入基本配置，如默认设置、用户创建和激活码。

以下屏幕截图显示了已安装 Nessus 的 web 视图。默认情况下，Nessus 在端口 8834 上运行：

![Installing Nessus on Windows 7](graphics/7440_01_11.jpg)

Nessus 对 SSL 证书发出警告。默认情况下，它不附带 SSL 证书。Nessus 管理员必须获得 SSL 证书才能使用 SSL 配置 Nessus。

如果您想立即安装 SSL 证书本身，请安装它；否则，点击**继续**。这将带您进入一开始的介绍页面。

点击**开始**继续。

![Installing Nessus on Windows 7](graphics/7440_01_13.jpg)

在此之后，您需要做的第一件事是管理帐户设置。此帐户是在 Nessus 服务器上创建的。Nessus 管理层应始终记住该账户。

![Installing Nessus on Windows 7](graphics/7440_01_14.jpg)

在管理账户创建后，Nessus 将提示进行插件订阅注册和代理设置，这是可选的。

![Installing Nessus on Windows 7](graphics/7440_01_15.jpg)

插件提要必须根据您的预期用途进行注册。注册后，您将获得一个激活码，用于插件订阅。

## 在 Linux 上安装 Nessus

对于最新的 Nessus 套餐，无论是出于购买还是评估目的，您都应该访问 Tenable Nessus 的官方网站[http://www.tenable.com/](http://www.tenable.com/) ：

1.  登录 Nessus 网站，根据您的操作系统和版本从**产品**部分购买并下载最新的 Nessus 软件。这里概述的步骤适用于 Red Hat Linux 5.2。
2.  Once you have downloaded the Nessus executable file (the Nessus setup package), double-click on it to start the installation procedure. Administrative/root rights are required for installation.

    ![Installing Nessus on Linux](graphics/7440_01_61.jpg)

    您将在下面的屏幕截图中看到**安装软件包**窗口：

    ![Installing Nessus on Linux](graphics/7440_01_62.jpg)

3.  Click on the **Apply** button.

    ![Installing Nessus on Linux](graphics/7440_01_63.jpg)

4.  Click on **Install anyway** to proceed further with the installation.

    ![Installing Nessus on Linux](graphics/7440_01_64.jpg)

    前面的屏幕截图显示 Nessus 已成功安装在 Red Hat Linux 环境中。首先，应启动 Nessus 服务。

5.  The following command should be executed to start the Nessus service on the Linux terminal:

    ```
    # /sbin/service nessusd start

    ```

    以下屏幕截图显示 Nessus 服务以状态**OK**启动：

    ![Installing Nessus on Linux](graphics/7440_01_65.jpg)

6.  To configure the Nessus scanner, type the URL `https://localhost.localdomain:8834/` into the Linux box web browser.

    此页面显示安全连接错误，可通过向 web 浏览器添加异常来纠正此错误。

7.  点击**上的按钮，也可以添加异常**链接。
8.  点击**添加异常**和**获取证书**。这将激活按钮**确认安全异常**。单击此按钮后，web 浏览器将显示 Nessus 扫描仪主页。

为了进一步配置，可以按照与 Windows 安装相同的步骤进行注册、激活、更新插件、用户管理等。

# 定义更新

更新 Nessus 定义（插件）非常重要，因为这可以使 Nessus 保持更新，并能够识别所有最新的漏洞。要成功地使用 Nessus 进行漏洞扫描，在进行扫描之前，请检查 Nessus 并使用最新插件更新它，这一点很重要。

要在 Windows 计算机上更新 Nessus，应执行以下步骤：

1.  使用管理员帐户登录 Nessus 服务器。
2.  点击顶部菜单栏的**配置**选项卡。
3.  点击**配置**页签后，Nessus 将打开系统配置设置。这将有子选项卡，即**常规设置**、**馈送设置**、**移动设置**、**结果设置**和**高级设置**。
4.  Click on the **Feed Settings** tab on the left-hand selection panel. This will open up a page to update the Nessus plugins feed.

    ![Definition update](graphics/7440_01_59.jpg)

Nessus 提供了多种馈送选项，如下所示：

*   在线插件更新
*   离线插件更新
*   自定义插件提供基于主机的更新

## 在线插件更新

在线插件更新是更新 Nessus 插件最流行的选项，提供通过互联网更新插件的能力。这需要 Nessus 机器上具有相当高速度的 Internet 连接。Nessus 注册激活后，点击**更新插件**按钮即可更新插件。

## 离线插件更新

离线插件更新用于将插件归档到本地目录中，Nessus 可以从该目录获取提要和更新。这不需要 Nessus 系统上的 Internet 连接。要设置脱机更新，请首先获取 Nessus 订阅激活代码，该代码可以从 Nessus 支持或用于 Nessus 订阅源注册的注册电子邮件 ID 中检索。

下一步是生成一个质询代码，用于下载插件和激活代码。

要在 Windows Nessus 计算机上生成质询代码，请在命令行工具中运行以下命令：

```
\Program Files\Tenable\Nessus> nessus-fetch.exe --challenge

```

对于 Linux Nessus 机器，命令略有不同；应在 Linux 终端上运行以下命令：

```
# /opt/nessus/bin/nessus-fetch --challenge

```

这将生成一个长字符串，称为质询代码。质询代码示例为`19c4ed603ac3e436a14239852c8fbf8f26f02d7b`。

要继续脱机下载插件，请转到位于[的 Nessus 插件脱机下载页面 https://plugins.nessus.org/offline.php](https://plugins.nessus.org/offline.php) 。加载后，页面会提示输入质询代码和激活代码。将这些输入到。

![Offline plugin updates](graphics/7440_01_60.jpg)

## 自定义插件提供基于主机的更新

使用此选项可以设置自定义插件提要主机。可以提供主机名或主机 IP 地址进行设置。

# 用户管理

用户管理是 Nessus 提供的一项附加功能，在大型企业环境中，Nessus 由多个地点的多人使用时最为有用。在这样的环境中，此功能使管理员能够为 Nessus 扫描仪上的多个用户启用不同级别的访问。

Nessus 为用户提供两种不同的角色，如下所示：

*   管理员
*   非行政人员

管理员角色可以访问 Nessus 的所有功能，而非管理员角色的访问权限有限。非管理员角色无权访问用户管理、常规设置、提要设置和高级设置。

安装 Nessus 时，会为 Nessus 管理创建一个管理用户。要继续 Nessus 用户管理，必须使用此帐户登录，因为它具有管理员权限。

可以在 Windows 计算机上浏览 URL`https://localhost:8834/`。

![User management](graphics/7440_01_54.jpg)

输入要登录的管理员用户名和密码。这将显示 Nessus 的主页，如前面的屏幕截图所示。

管理登录下将显示多个选项卡。点击**用户**选项卡，进一步用户管理活动。

在 Nessus 中，用户管理提供以下选项：

*   添加新用户
*   删除现有用户
*   更改现有用户的密码
*   更改现有用户的角色

## 添加新用户

点击的**新用户**按钮，添加新用户。

![Adding a new user](graphics/7440_01_55.jpg)

这将显示新用户提示，以设置新用户的用户名、密码和角色，如以下屏幕截图所示：

![Adding a new user](graphics/7440_01_56.jpg)

## 删除现有用户

删除用户是 Nessus 扫描仪不再需要用户时使用的功能。在这种情况下，从**用户**标题中选择需要删除的用户，并从右侧显示的选项中点击**删除用户**按钮。

![Deleting an existing user](graphics/7440_01_57.jpg)

## 更改现有用户的密码或角色

有时，管理员会收到更改用户密码的请求。这可能是因为用户忘记了自己的密码，或者是因为他/她的角色需要更改。在这种情况下，选择需要更改其密码或角色的用户，然后双击该用户。这将使用以下窗口提示您设置新密码或更改角色：

![Changing the password or role of an existing user](graphics/7440_01_58.jpg)

# Nessus 系统配置

Nessus 系统配置设置可在**配置**页签下参考。这有五组不同的设置，如下所示：

*   一般设置
*   馈送设置
*   移动设置
*   结果设置
*   高级设置

## 一般设置

在**配置**下，以管理员权限登录 Nessus 即可看到**常规设置**页签。在**设置类型**下拉列表中存在两种不同的**常规设置**选项：

*   SMTP 服务器
*   网络代理

SMTP 服务器设置允许您将 SMTP 服务器与 Nessus 服务器配置为通过自动电子邮件发送已完成扫描的结果。

![General Settings](graphics/7440_01_51.jpg)

### SMTP 设置

SMTP 的不同设置可以根据您的 SMTP 配置进行配置。下表说明了 SMTP 设置：

<colgroup><col style="text-align: left"> <col style="text-align: left"></colgroup> 
| 

SMTP 设置

 | 

描述

 |
| --- | --- |
| 主办 | SMTP 服务器主机名或 IP。 |
| 港口城市 | 连接 SMTP 服务器的端口号。 |
| 发件人（电子邮件） | 报告电子邮件中的电子邮件 ID 应显示为发件人。 |
| 认证方法 | SMTP 身份验证方法。 |
| 用户名 | 用于向 SMTP 服务器进行身份验证的用户名。 |
| 暗语 | 与此用户名对应的密码。 |
| Nessus 服务器主机名 | 这仅适用于要指定的电子邮件链接、Nessus 服务器主机名或 IP 地址。 |
| 发送测试电子邮件 | 允许您通过发送测试电子邮件进行测试。 |

### 网络代理设置

一些组织在外部网络和内部网络之间托管一个 web 代理服务器，以传递流量。要使用 web 代理环境中的最新插件更新 Nessus，必须根据组织设置配置 web 代理设置。这使 Nessus 能够通过互联网访问 Nessus 插件服务器，下载最新的插件。

可以根据您的 web 代理配置配置 web 代理的不同设置。下表说明了这些设置：

<colgroup><col style="text-align: left"> <col style="text-align: left"></colgroup> 
| 

Web 代理设置

 | 

描述

 |
| --- | --- |
| 主办 | 代理主机名或 IP。 |
| 港口城市 | 代理要连接的端口号。 |
| 用户名 | 要将代理连接到的用户名。 |
| 暗语 | 将代理连接到的用户名的密码。 |
| 用户代理 | 如果代理使用特定于筛选器的 HTTP 用户代理，则为必需。需要指定自定义用户代理字符串。 |

## 进料设置

本章*定义更新*部分对**进给设置**进行了说明。

## 移动设置

随着移动设备在企业领域的广泛使用，**自带设备**（**BYOD**）等概念被积极使用，近年来移动设备安全问题已成为当务之急。当这些设备连接到公司网络时，会带来其移动平台固有的漏洞。Nessus 提供了移动安全扫描选项，可扫描最近连接到相应服务器的移动设备的信息和漏洞。

目前，包括与 iPhone 4、iPad、Windows Phone 和 Android 设备相关的插件，Nessus 能够扫描**Active Directory 服务接口**（**ADSI**）和 Apple Profile Manager，以识别连接到这些服务器的移动设备，并识别漏洞。

**移动设置**选项卡提供选项，用于配置以下类型的设置：

*   **动态同步（交换）**
*   **苹果档案管理器**
*   **有利于企业**

这可以在以下屏幕截图中看到：

![Mobile Settings](graphics/7440_01_52.jpg)

### 动态同步（交换）

Nessus 可以配置为使用 ActiveSync 收集所有使用此协议获取电子邮件的移动设备的信息（通过 Exchange）。如果您有 Exchange 部署，则可以配置域控制器设置，如下表所示：

<colgroup><col style="text-align: left"> <col style="text-align: left"></colgroup> 
| 

动态同步移动设置

 | 

描述

 |
| --- | --- |
| 域控制器 | 域控制器 IP。 |
| 领域 | 域名。 |
| 域用户名 | 要将域连接到的用户名。 |
| 域密码 | 要连接到的用户名的密码。 |

### 苹果档案管理器

Nessus 可以配置为使用 Apple Profile Manager 收集所有 iOS 设备的信息。如果已部署 Apple Profile Manager，则可以配置 Apple Profile Manager 设置，如下表所示：

<colgroup><col style="text-align: left"> <col style="text-align: left"></colgroup> 
| 

Apple Profile Manager 移动设置

 | 

描述

 |
| --- | --- |
| Apple Profile Manager 服务器 | Apple Profile Manager 服务器 IP。 |
| Apple 配置文件管理器端口 | 要连接的 Apple Profile Manager 服务器端口。 |
| Apple Profile Manager 用户名 | 用于登录的用户名。 |
| Apple 配置文件管理器密码 | 与用户名对应的密码。 |
| SSL | 根据环境选中/取消选中此选项。 |
| 验证 SSL 证书 | 如果希望验证 SSL 证书，请选中此选项。 |
| 强制设备更新 | 如果要强制进行设备更新，请选中此选项。 |
| 设备更新超时（分钟） | 设备更新超时（分钟）。 |

### 对企业有好处

Nessus 可以配置为使用良好的移动设备管理来收集所有使用此协议的移动设备的信息。如果已部署 Good For Enterprise，则可以配置下表中列出的设置：

<colgroup><col style="text-align: left"> <col style="text-align: left"></colgroup> 
| 

适合企业移动环境

 | 

描述

 |
| --- | --- |
| GMC 服务器 | 这里需要提到 GMC 服务器 IP。 |
| 港口城市 | 用于连接 GMC 服务器的端口号。 |
| 领域 | 域名。 |
| 用户名 | 要连接的用户名。 |
| 暗语 | 与用户名对应的密码。 |
| SSL | 根据环境选中/取消选中此选项。 |
| 验证 SSL 证书 | 如果要验证设备，请选中此选项。 |

## 结果设置

在**配置**下可以看到**结果设置**。此允许您添加规则以禁用插件或更改其严重性。

以下屏幕截图显示了如何添加新的插件规则：

![Result Settings](graphics/7440_01_53.jpg)

下表详细说明了新的插件规则选项：

<colgroup><col style="text-align: left"> <col style="text-align: left"></colgroup> 
| 

新插件规则选项

 | 

描述

 |
| --- | --- |
| 主办 | 如果结果插件规则仅适用于特定 IP/主机，则可以在主机字段中提及该主机。如果要对扫描的整个主机应用该规则，则可以将其留空。 |
| 插件 ID | 要提供的插件 ID，用于指定规则适用于哪个插件。 |
| 到期日期 | 如果规则需要在特定日期过期，可以在此处指定其过期日期。 |
| 严重程度 | 可以根据要设置的规则从下拉列表中设置严重性。它可能是隐藏的、信息性的、低级的、中级的、高级的或关键的。 |

### 高级设置

Nessus GUI 配置菜单包含多个可配置选项。

建议根据您的扫描环境对这些设置进行适当的检查和修改。可以使用**保存**按钮更改和保存该选项，也可以使用该选项旁边的**X**标志将其删除。

修改下表中的`max_hosts`和`max_checks`值时应特别小心。这些值表示一次扫描的最大检查数和主机数，对要执行的扫描有直接影响。`max_checks`值如果大于**5**，可能会对目标服务器产生不利影响，因此应避免使用。类似地，`max_hosts`的高值可能会淹没主机扫描系统，这取决于安装 Nessus 的主机的容量。建议该值也保持相对较低（可以从 10 开始）；它可以根据环境和系统能力进行优化。

下面的屏幕截图显示了下表中的一些选项；可分别使用**添加设置**选项卡和**X**按钮添加或删除选项。

下表列出了 Nessus 文档中的高级设置选项及其用途：

<colgroup><col style="text-align: left"> <col style="text-align: left"> <col style="text-align: left"></colgroup> 
| 

新插件规则选项

 | 

描述

 | 

默认值

 |
| --- | --- | --- |
| 允许\u 后\u 扫描\u 编辑 | 如果启用，则可以进行扫描后编辑。 | **是** |
| 自动启用依赖项 | 自动激活依赖它的插件。如果禁用，即使在扫描策略中选中，也不是所有插件都可以运行。 | **是** |
| 自动更新 | 控制自动插件更新。如果启用并注册 Nessus，它会自动从 plugins.Nessus.org 获取最新的插件。如果扫描仪位于无法连接到 Internet 的隔离网络上，则禁用。 | **是** |
| 自动更新延迟 | 两次更新之间等待的小时数。四小时（4）是允许的最小间隔时间。 | **24** |
| cgi_ 路径 | 在测试 web 服务器期间，使用以冒号分隔的 CGI 路径列表。 | `/cgi-bin:/scripts` |
| 检查\u 读取\u 超时 | 用于指定测试套接字的读取超时。 | **5** |
| 禁用 ntp | 禁用旧的 NTP 旧协议。 | **是** |
| 禁用 xmlrpc | 禁用新的 XMLRPC（web 服务器）接口。 | **否** |
| 转储文件 | 用于指定转储文件的位置，以便在生成输出时调试输出。 | `C:\ProgramData\Tenable\Nessus\nessus\logs\nessusd.dump` |
| global.max_ 主机 | 可以扫描的最大主机数。 | **130** |
| global.max\u 扫描 | 如果设置为非零，则允许您定义并行进行的最大扫描数。 | **0** |
| global.max\u 模拟\u tcp\u 会话 | 同时 TCP 连接的最大数目 | **50** |
| global.max\u web\u 用户 | 如果设置为非零，则定义可以并行连接的最大（web）用户数。 | **1024** |
| 监听地址 | 用于侦听传入连接的 IPv4 地址。如果设置为 127.0.0.1，这将仅限制对本地连接的访问。 | **0.0.0.0** |
| 监听端口 | 要侦听的端口（旧的 NTP 协议）。用于 4.2 版之前的 NessusClient 连接。 | **1241** |
| 记录整个攻击 | 允许您记录攻击的每个细节，并有助于调试扫描问题，但这可能会占用大量磁盘空间。 | **否** |
| 日志文件 | 存储 Nessus 日志文件的位置。 | `C:\ProgramData\Tenable\Nessus\nessus\logs\nessusd.messages` |
| 最高支票 | 对每个测试主机同时进行检查的最大次数。 | **5** |
| 最大主机数 | 扫描期间一次检查的最大主机数。 | **5** |
| nasl_ 日志 _ 类型 | 在`nessusd.dump`中指示 NASL 发动机输出的类型。 | **正常** |
| nasl 无签名检查 | 允许您指定涅索斯是否应将所有 NASL 脚本视为已签名。选择“是”不安全，不建议选择。 | **否** |
| 非模拟端口 | 允许您指定不应同时运行两个插件的端口。 | **1394453389** |
| 优化检验 | 用于优化测试过程。将更改为“否”将导致扫描花费更长的时间，通常会产生更多的误报。 | **是** |
| 插件上传 | 用于指定管理员用户是否可以上载插件。 | **是** |
| 插件超时 | 插件活动的最长生存期（秒）。 | **320** |
| `port_range` | 端口扫描仪将扫描的端口范围。可以使用关键字**Default**或**All**以及逗号分隔的端口列表或端口范围。 | **违约** |
| `purge_plugin_db` | 用于指定 Nessus 是否应在每次更新时清除插件数据库。这将指示 Nessus 为每次更新删除、重新下载和重建插件数据库。选择**是**将导致每次更新速度大大降低。 | **否** |
| `qdb_mem_usage` | 指示 Nessus 在空闲时使用更多或更少的内存。如果 Nessus 在专用服务器上运行，将其设置为**高**将使用更多内存来提高性能。如果 Nessus 在共享机器上运行，将其设置为**低**将使用相当少的内存，但代价是适度的性能影响。 | **低** |
| `reduce_connections_on_congestion` | 允许您在发生拥塞时减少连接。 | **否** |
| `report_crashes` | 允许您指定是否向 Tenable 匿名报告崩溃。 | **是** |
| `Rules` | Nessus 规则文件的位置（`nessusd.rules`。 | `C:\ProgramData\Tenable\Nessus\conf\nessusd.rules` |
| `safe_checks` | 安全检查依靠抓取横幅，而不是主动测试漏洞。 | **是** |
| `silent_dependencies` | 如果启用此选项，则报告中不包括插件依赖项列表及其输出。可以选择一个插件作为依赖于其他插件运行的策略的一部分。默认情况下，Nessus 将运行这些插件依赖项，但不会在报告中包含它们的输出。将此选项设置为**否**将导致所选插件和任何插件依赖项都出现在报告中。 | **是** |
| `slice_network_addresses` | 如果设置了此选项，Nessus 将不会以增量方式扫描网络（10.0.0.1、10.0.0.2、10.0.0.3 等），而是尝试在整个网络中分割工作负载（例如，它将扫描 10.0.0.1、10.0.0.127、10.0.0.2、10.0.0.128 等）。 | **否** |
| `ssl_cipher_list` | 确保在连接到端口 1241 时仅使用“强”SSL 密码。支持关键字 strong 或[中列出的通用 OpenSSL 名称 http://www.openssl.org/docs/apps/ciphers.html](http://www.openssl.org/docs/apps/ciphers.html) 。 | **强** |
| `stop_scan_on_disconnect` | 让您停止扫描在扫描期间似乎已断开连接的主机。 | **否** |
| `stop_scan_on_hang` | 用于停止似乎已挂起的扫描。 | **否** |
| `throttle_scan` | 油门扫描适用于 CPU 过载的情况。 | **是** |
| `www_logfile` | 用于指定 Nessus web 服务器（用户界面）日志的存储位置。 | `C:\ProgramData\Tenable\Nessus\nessus\logs\www_server.log` |
| `xmlrpc_idle_session_timeout` | Nessus 的空闲会话超时。 | **30** |
| `xmlrpc_listen_port` | Nessus web 服务器要侦听的端口（新的 XMLRPC 协议）。 | **8834** |

所有这些高级设置在应用之前都需要进行适当的分析。建议的设置可能因环境而异。

本章的几个部分是具体的配置设置，已从 Nessus 网站上的学习资料中引用：[http://www.tenable.com](http://www.tenable.com) 。

# 总结

在本章中，我们学习了有关漏洞评估和渗透测试的基础知识，并介绍了 Nessus。

VA 和 PT 是技术风险评估的关键类型，VA 专注于发现基础设施中的弱点或漏洞，PT 则进入下一个级别来利用这些漏洞。

此类评估作为预防性控制进行，以识别和缓解漏洞或各种合规要求。此类测试的关键活动包括范围界定、信息收集、漏洞扫描、误报分析、漏洞利用（渗透测试）和报告生成。范围界定包括一种不同的方法来测试 Blackbox（没有关于基础设施的信息）和 Greybox（共享关于基础设施的凭证和详细信息）。

在本章中，我们还介绍了 Nessus 作为广泛使用的漏洞扫描器之一。它使用称为插件的安全检查，在扫描过程中识别漏洞。关键插件系列包括 Windows、Linux、Solaris、Cisco 和数据库。多年来，Nessus 除了漏洞扫描程序的主要功能外，还增加了配置和合规性检查等功能。

Nessus 可以安装在所有主要操作系统上，本章介绍了在 Windows 7 和 Linux 操作系统上安装 Nessus 的详细步骤以及先决条件。

在初始设置期间，将创建初始管理员帐户以管理员身份登录 Nessus，并根据需要激活家庭或专业订阅源。

然后更新插件。还解释了离线更新插件的选项。Nessus 提供了一个用户管理部分，用于创建 Nessus 用户并授予这些权限以供将来使用。最后介绍了 Nessus 系统配置设置，如**馈送设置**、**移动设置**、**高级设置**等。

在下一章中，我们将学习如何使用 Nessus 扫描 IT 基础架构。
# 第二章：使用 Kali Linux 设置您的机器

在本章中，我们将介绍以下主题，以设置您的笔记本电脑进行无线渗透测试：

*   Kali Linux 发行版简介
*   安装 Kali Linux
*   无线适配器设置和配置

# Kali Linux 发行版简介

Kali Linux 是渗透测试和安全审计中最流行和使用的发行版。它是由攻击性安全部门开发和维护的，它取代了 Backtrack Linux，后者是 Backtrack 5 第 3 版的继承者 Kali Linux 的第一个版本。

Kali Linux 已经完全重新构建，现在它基于 Debian。它包括用于侦察和信息收集、嗅探和欺骗、漏洞评估、密码破解、漏洞利用、反向工程、硬件黑客攻击、取证调查、事件处理和报告的各种工具。对于无线渗透测试，有一套最知名的开源工具专用（“T0”元包），如 Aircrack ng suite、Kismet、Fern Wifi Cracker、Wifite 和 Reaver 等。

在本书中，我们将主要使用由 Thomas d'Otreppe 开发的 Aircrack ng 套件，因为它是用于审核无线网络的最完整和最流行的工具集。有关机组 ng 项目的更多信息，请访问其网站[http://www.aircrack-ng.org/](http://www.aircrack-ng.org/) ，本书中经常引用。此外，Kali Linux 支持多种无线适配器，其内核不断更新最新的无线注入补丁。

出于所有这些原因，Kali Linux 是我们的最佳选择。下一节将演示如何在笔记本电脑上安装它。

# 安装 Kali Linux

有三种方法可以将 Kali Linux 安装在硬盘（单引导或多引导）、USB 拇指驱动器（将其用作实时系统）或使用软件（如 Oracle VirtualBox 和 VMware Workstation 或 Player）的虚拟机上。

安装需要至少 10GB 的硬盘空间，建议至少 1024MB 的 RAM，尽管 Kali Linux 只能运行 512MB 的 RAM。

在硬盘上安装 Kali Linux 的性能更好，但其缺点是将所有硬盘空间专用于硬盘，或者对硬盘进行分区，然后使用分区安装硬盘，虽然虚拟机上的安装为我们提供了一个稍慢的系统，但也提供了更大的灵活性，我们不必修改硬盘的配置。

我们可以在带有可下载的 ISO 的虚拟机上安装 Kali Linux，也可以直接使用 VMware 或 VirtualBox 预构建的映像。32 位或 64 位 ISOs 可从[下载 https://www.kali.org/downloads/](https://www.kali.org/downloads/) ，VMware 和 VirtualBox 图像可从[下载 https://www.offensive-security.com/kali-linux-vmware-arm-image-download/](https://www.offensive-security.com/kali-linux-vmware-arm-image-download/) 。有趣的是，Kali Linux 也可以安装在 ARM 设备上，比如 Raspberry Pi 和类似的设备。

本章的其余部分将介绍在虚拟机上安装和配置 Kali Linux，这一过程与直接在硬盘上安装非常相似。

## 在虚拟机上安装

要创建新的虚拟机器并在其上安装 Kali Linux，我们需要使用虚拟化软件。

在本书中，我们将使用 Oracle VirtualBox，它是一种免费的开源虚拟化软件，可用于各种平台，如 Windows、Linux、Mac OS X 和 Solaris。要下载并获取有关如何安装的信息，请查看[附录](9.html "Appendix A. References")、*参考*中的参考资料。

### 创建新的虚拟机

要创建新的虚拟机（VM），请执行以下步骤：

1.  Click on the **New** button on the toolbar menu and the wizard will start. We assign the VM a name and select the operating system type and version, which, in our case, are Linux and Debian respectively (the architecture, 32 or 64 bit, depends on your machine):

    ![Creating a new virtual machine](graphics/B04527_02_01.jpg)

2.  We assign the amount of RAM dedicated to the VM; here the recommended size is 512 MB but for our purposes at least 1,024 MB would be a better choice:

    ![Creating a new virtual machine](graphics/B04527_02_02.jpg)

3.  Then, we have to create a new virtual hard disk for our installation:

    ![Creating a new virtual machine](graphics/B04527_02_03.jpg)

4.  We choose **VDI (VirtualBox Disk Image)** as the virtual disk format:

    ![Creating a new virtual machine](graphics/B04527_02_04.jpg)

5.  We select the **Dynamically allocated** option, which only uses the space on the physical drive as the virtual disk file grows, up to the fixed maximum size:

    ![Creating a new virtual machine](graphics/B04527_02_05.jpg)

6.  We set up the virtual disk file location and the maximum size; then we click on the **Create** button and the VM is ready!

    ![Creating a new virtual machine](graphics/B04527_02_06.jpg)

### 安装步骤

此时，创建了虚拟机，我们准备在其上安装 Kali Linux 操作系统。为此，我们遵循以下步骤：

1.  We select the newly created Kali Linux VM in the left pane of the Oracle VM VirtualBox Manager, and next, we click on **Settings** on the toolbar menu and then on **Storage**. We select the **Controller: IDE** entry associated with the **CD/DVD Drive** field, and in the **Attributes** section, we choose the Kali Linux ISO on the hard drive. This is analogous to inserting a Kali Linux installation DVD in the physical drive when installing it on the hard disk directly, so that the machine can boot from it:

    ![Installation steps](graphics/B04527_02_07.jpg)

2.  Now, we start the VM clicking on the **Start** button on the toolbar menu. The VM boots from the ISO and the installation boot menu is shown in the following screenshot:

    ![Installation steps](graphics/B04527_02_08.jpg)

3.  We follow the steps of the installation wizard, selecting in succession the language (default is English), the country, the locale setting, the keyboard layout, the hostname, and the domain name. Then, we need to set up the password of the root account. Root is the default and the most privileged account in the system, which has the full administrative rights:

    ![Installation steps](graphics/B04527_02_09.jpg)

4.  We select the time zone and then we need to choose the disk partitioning method. We can choose the guided methods (using three different schemes) or the manual one if we desire to partition the disk. In our case, we are going to select the first method and use the entire virtual disk associated with the VM:

    ![Installation steps](graphics/B04527_02_10.jpg)

5.  Then, the installer asks which disk to use for installing the system (in our case, it is unique), and in the following window, whether we want to use a single partition or create separate partitions for different mount points (for example, `/home`, `/usr/local`, `/opt`, and so on):

    ![Installation steps](graphics/B04527_02_11.jpg)

6.  The installer creates the root (`/`) and the swap partitions and asks to confirm it, writing the changes on the virtual disk:

    ![Installation steps](graphics/B04527_02_12.jpg)

7.  After all the data is copied to the disk, the installer asks whether we want to use a network mirror to install the software that is not included in the installation ISO or to update the installed software. Then, we need to choose whether or not to install the GRUB boot loader on the **Master Boot Record** (**MBR**) of the virtual disk. We are going to install it:

    ![Installation steps](graphics/B04527_02_13.jpg)

8.  One step more and the installation is complete. Now we have a brand new Kali Linux system on our VM! We can restart the VM to boot it up, after having removed the installation ISO from the virtual CD/DVD drive:

    ![Installation steps](graphics/B04527_02_14.jpg)

# 无线适配器设置和配置

现在我们已经在虚拟机上安装了 Kali Linux，现在是时候讨论一下无线适配器配置了。但是，首先让我们看看它的要求。

## 无线适配器的要求

无线适配器必须满足以下主要要求才能适用于无线渗透测试：

*   与 IEEE 802.11b/g/n Wi-Fi 标准兼容，也可能与 802.11a 兼容，802.11a 运行在 5 GHz 频段（双频支持）。
*   将卡置于所谓的*监控模式*的能力，允许嗅探所有无线流量。监控模式相当于有线网络中的混杂模式。
*   支持*包注入*主动向网络注入流量的能力。

为了验证我们的 Wi-Fi 适配器是否满足这些要求，我们首先需要确定其芯片组，并验证其 Linux 驱动程序是否同时支持监控模式和数据包注入。我们将在本章后面看到如何实际测试适配器是否满足这些要求。

### 注

**验证适配器芯片组兼容性**

*教程提供了确定芯片组并验证其兼容性的大量资源：我的无线网卡兼容吗？Aircrack ng documentation wiki 上的*和*兼容性*部分（参见*第 2 章*、*使用 Kali Linux*设置您的机器的参考部分，在[附录](9.html "Appendix A. References")、*参考*中）。

他们提供了芯片组的详细列表及其对无线渗透测试的支持级别。

如果我们的笔记本电脑不是很旧，那么几乎可以肯定它配备了内置 Wi-Fi 卡。内部卡通常不是无线渗透测试的最佳选择，因为它们的大多数芯片组在 Kali Linux 上不受支持。此外，我们不能在虚拟机中使用内部卡，因为我们需要直接访问设备才能工作，而虚拟机只允许直接访问 USB 设备。因此，如果 Kali Linux 在虚拟机上运行，我们只能使用 USB 无线适配器。

出于这些原因，推荐的选择是使用带有外部高增益天线的 USB 无线适配器，该天线比集成天线具有更大的发射功率和灵敏度，因此允许远程信号接收和发射。

Kali Linux 支持的具有这些特性的适配器价格低廉，因此在无线渗透测试人员中非常流行的是 Alfa Networks AWUS036NH USB 卡。这张卡有一个 Ralink 芯片组。在 Linux 下得到良好支持的其他芯片组包括 Atheros 和 Realtek RTL8187L 芯片组。

在本书的其余部分中，我们假设您使用的是 USB 无线适配器。

## 无线网卡配置

将适配器连接到 USB 端口后，我们必须将其配置为在安装了 Kali Linux 的虚拟机中使用。

1.  我们启动 VirtualBox 虚拟机管理器，在左侧窗格中选择我们的 Kali Linux 虚拟机，然后导航到**设置****USB**。首先，我们应该启用 USB 2.0 控制器，如果我们还没有启用它的话。这需要安装 VirtualBox 扩展包（有关更多信息，请参阅*安装 VirtualBox 扩展包*信息框）。
2.  We click on the add a new USB device filter (the green plus icon) on the right and select the device that corresponds to our wireless adapter:

    ![Wireless card configuration](graphics/B04527_02_15.jpg)

    ### 注

    **安装 VirtualBox 扩展包**

    我们可以从[下载扩展包 https://www.virtualbox.org/wiki/Downloads](https://www.virtualbox.org/wiki/Downloads) 根据安装的 VirtualBox 版本选择合适的文件。

    有关 VirtualBox 扩展包及其安装方法的信息，请访问[https://www.virtualbox.org/manual/ch01.html#intro-安装](https://www.virtualbox.org/manual/ch01.html#intro-installing)。

3.  We start our VM that should now be able to use our wireless adapter via its USB pass-through capability. After the Kali Linux within the VM has booted, we log in to the system as root and open the terminal emulator. We type the `iwconfig` command to list all the wireless interfaces available on our system:

    ![Wireless card configuration](graphics/B04527_02_16.jpg)

    系统已经为我们的适配器分配了`wlan0`接口，但它仍然没有激活，从`ifconfig`输出可以看出：

    ![Wireless card configuration](graphics/B04527_02_17.jpg)

4.  To bring the `wlan0` interface up, we execute the `ifconfig wlan0 up` command and then `ifconfig` to verify that it has been activated. Now, our wireless interface is up and running, as we can notice in the following screenshot:

    ![Wireless card configuration](graphics/B04527_02_18.jpg)

### 测试无线渗透测试适配器

现在我们已经设置了适配器，我们可以运行一个小小的测试来验证它是否真的适合无线渗透测试，也就是说，它可以被置于监控模式，并且支持数据包注入。为此，我们使用了 Aircrack ng 套件中的两个程序，这两个程序也将在本书的其余部分广泛使用。

首先，我们执行`airmon-ng start wlan0`将接口置于监控模式。

如果命令成功完成，并且在新创建的界面`mon0`上启用了监控模式，则表示已通过本次测试！

![Testing the adapter for wireless penetration testing](graphics/B04527_02_19.jpg)

接下来，我们运行`aireplay-ng -9 wlan0`命令，`-9`选项表示这是一个注入测试（完整形式为`--test`：

![Testing the adapter for wireless penetration testing](graphics/B04527_02_20.jpg)

Aireplay ng 是一种用于生成和注入帧的工具，我们将使用它来执行本书中介绍的许多攻击。

如果输出中出现`Injection is working!`字符串，则测试成功，我们的适配器支持数据包注入！

测试也提供了其他有价值的信息；它告诉我们无线接口正在使用的信道以及通过对广播探测或接收到的信标的响应找到的接入点以及相关连接质量（我们将在[第 3 章](3.html "Chapter 3. WLAN Reconnaissance")、*WLAN 侦察*中讨论这些主题）。

有关注射试验的更多信息，请参见[http://www.aircrack-ng.org/doku.php?id=injection_test](http://www.aircrack-ng.org/doku.php?id=injection_test) 。

### 故障排除

正如我们所看到的，Kali Linux 发行版支持多种无线适配器，我们在配置无线适配器时应该不会遇到任何问题。

然而，有时我们的适配器不会显示在`iwconfig`输出上。在这种情况下，我们可以检查`lsusb`或`lspci`工具的输出（取决于接口类型），查看设备是否已被操作系统检测到，以及`dmesg`的输出，以检查相关驱动程序是否已正确加载。

在其他情况下，可能会出现无线适配器被识别，但`ifconfig wlan0 up`命令无法启动接口，错误消息为`'SIOCSIFFLAGS : No such file or directory'`。此错误通常表示驱动程序无法加载适配器固件，因为它丢失或安装不正确。

我们可以通过安装适配器驱动程序文档中标识的正确固件来解决此问题。

例如，要安装一个 Ralink 芯片组适配器的固件包，我们执行以下命令：

```
apt-get install firmware-ralink

```

有关无线适配器配置故障排除的更多详细信息，请参见[附录](9.html "Appendix A. References")、*参考文献*。

# 总结

在本章中，我们了解了如何使用 virtual Box 创建虚拟机以及如何在其上安装 Kali Linux。在介绍了无线适配器的无线渗透测试要求之后，我们将 USB 无线适配器配置为与 Kali Linux 一起使用，并根据前面分析的要求对其进行了测试。

在下一章中，我们将介绍无线渗透测试的发现和信息收集阶段。